var T=(j,K,P)=>{if(j)switch(K){case 1:return new Int8Array(P);case 2:return new Int16Array(P);case 4:return new Int32Array(P);default:throw new RangeError(`Invalid parameter: ${K}`)}switch(K){case 1:return new Uint8Array(P);case 2:return new Uint16Array(P);case 4:return new Uint32Array(P);default:throw new RangeError(`Invalid parameter: ${K}`)}};var p="\x00",l=0,F=0,M=-1,C=new TextEncoder,S1=new TextDecoder;class b{#j;#K;#P;constructor(j=1024){this.#j=F+1,this.#K={signed:!0,bytes:4,array:T(!0,4,j)},this.#P={signed:!0,bytes:4,array:T(!0,4,j)},this.#K.array[F]=1,this.#P.array[F]=F,this.#$(this.#K.array,F+1,this.#K.array.length),this.#J(this.#P.array,F+1,this.#P.array.length)}#$(j,K,P){for(let $=K;$<P;$++)j[$]=-$+1;if(0<this.#P.array[this.#P.array.length-1]){let $=this.#P.array.length-2;while(0<this.#P.array[$])$--;j[K]=-$}}#J(j,K,P){for(let $=K;$<P;$++)j[$]=-$-1}#q(j){let K=j*2,P=T(this.#K.signed,this.#K.bytes,K);this.#$(P,this.#K.array.length,K),P.set(this.#K.array),this.#K.array=P;let $=T(this.#P.signed,this.#P.bytes,K);this.#J($,this.#P.array.length,K),$.set(this.#P.array),this.#P.array=$}getBaseBuffer(){return this.#K.array}getCheckBuffer(){return this.#P.array}loadBaseBuffer(j){return this.#K.array=j,this}loadCheckBuffer(j){return this.#P.array=j,this}size(){return Math.max(this.#K.array.length,this.#P.array.length)}getBase(j){if(this.#K.array.length-1<j)return-j+1;return this.#K.array[j]}getCheck(j){if(this.#P.array.length-1<j)return-j-1;return this.#P.array[j]}setBase(j,K){if(this.#K.array.length-1<j)this.#q(j);this.#K.array[j]=K}setCheck(j,K){if(this.#P.array.length-1<j)this.#q(j);this.#P.array[j]=K}setFirstUnusedNode(j){this.#j=j}getFirstUnusedNode(){return this.#j}shrink(){let j=Math.max(this.#K.array.length,this.#P.array.length)-1;while(0<=this.#P.array[j])j--;this.#K.array=this.#K.array.subarray(0,j+2),this.#P.array=this.#P.array.subarray(0,j+2)}calc(){let j=0,K=this.#P.array.length;for(let P=0;P<K;P++)if(this.#P.array[P]<0)j++;return{all:K,unused:j,efficiency:(K-j)/K}}dump(){let j="",K="";for(let P of this.#K.array)j+=` ${P}`;for(let P of this.#P.array)K+=` ${P}`;return console.log(`base:${j}`),console.log(`check:${K}`),`base:${j} check:${K}`}}class t{#j;#K;constructor(j=1024){this.#j=new b(j),this.#K=[]}append(j,K){return this.#K.push({k:j,v:K}),this}build(j=this.#K,K=!1){if(j==null)return new D(this.#j);let P=j.map(($)=>{return{k:C.encode($.k+p),v:$.v}});if(K)this.#K=P;else this.#K=P.sort(($,q)=>{let Z=$.k,J=q.k,Q=Math.min(Z.length,J.length);for(let X=0;X<Q;X++){if(Z[X]===J[X])continue;return Z[X]-J[X]}return Z.length-J.length});return this.#P(F,0,0,this.#K.length),new D(this.#j)}#P(j,K,P,$){let q=this.#$(K,P,$),Z=this.#q(q);this.#J(j,q,Z);for(let J=0;J<q.length;J=J+3){let Q=q[J];if(Q===l)continue;let X=q[J+1],H=q[J+2],Y=Z+Q;this.#P(Y,K+1,X,H)}}#$(j,K,P){let $=this.#K[K].k[j],q=new Int32Array(P*3),Z=0;q[Z++]=Number.parseInt(`${$}`),q[Z++]=K;let J=K,Q=K;for(;J<K+P;J++){let X=this.#K[J].k[j];if($!==X)q[Z++]=J-Q,q[Z++]=Number.parseInt(`${X}`),q[Z++]=J,$=X,Q=J}return q[Z++]=J-Q,q=q.subarray(0,Z),q}#J(j,K,P){let $=this.#j;$.setBase(j,P);for(let q=0;q<K.length;q=q+3){let Z=K[q],J=P+Z,Q=-$.getBase(J),X=-$.getCheck(J);if(J!==$.getFirstUnusedNode())$.setCheck(Q,-X);else $.setFirstUnusedNode(X);$.setBase(X,-Q);let H=j;if($.setCheck(J,H),Z===l){let Y=K[q+1],W=this.#K[Y].v;if(W==null)W=0;let v=-W-1;$.setBase(J,v)}}}#q(j){let K=this.#j,P,$=K.getFirstUnusedNode();while(!0){if(P=$-j[0],P<0){$=-K.getCheck($);continue}let q=!0;for(let Z=0;Z<j.length;Z=Z+3){let J=j[Z],Q=P+J;if(!this.#Q(Q)){$=-K.getCheck($),q=!1;break}}if(q)return P}}#Q(j){let P=this.#j.getCheck(j);if(j===F)return!1;if(P<0)return!0;return!1}}class D{#j;constructor(j){this.#j=j,this.#j.shrink()}contain(j){let K=j,P=this.#j;K+=p;let $=C.encode(K),q=F,Z=M;for(let J=0;J<$.length;J++){let Q=$[J];if(Z=this.#K(q,Q),Z===M)return!1;if(P.getBase(Z)<=0)return!0;q=Z}return!1}lookup(j){let K=j;K+=p;let P=C.encode(K),$=F,q=M;for(let J=0;J<P.length;J++){let Q=P[J];if(q=this.#K($,Q),q===M)return M;$=q}let Z=this.#j.getBase(q);if(Z<=0)return-Z-1;return M}commonPrefixSearch(j){let K=C.encode(j),P=[],$=F,q=M;for(let Z=0;Z<K.length;Z++){let J=K[Z];if(q=this.#K($,J),q!==M){$=q;let Q=this.#K(q,l);if(Q!==M){let X=this.#j.getBase(Q),H={k:"",v:0};if(X<=0)H.v=-X-1;H.k=S1.decode(K.slice(0,Z+1)),P.push(H)}continue}break}return P}#K(j,K){let P=this.#j.getBase(j)+K;if(this.#j.getCheck(P)===j)return P;return M}size(){return this.#j.size()}calc(){return this.#j.calc()}dump(){return this.#j.dump()}}var B={builder:(j=1024)=>{return new t(j)},load:(j,K)=>{let P=new b(0);return P.loadBaseBuffer(j),P.loadCheckBuffer(K),new D(P)}};class d{forward_dimension;backward_dimension;#j;constructor(j,K){this.forward_dimension=j,this.backward_dimension=K,this.#j=new Int16Array(j*K+2),this.#j[0]=j,this.#j[1]=K}put(j,K,P){let $=j*this.backward_dimension+K+2;if(this.#j.length<$+1)throw"ConnectionCosts buffer overflow";this.#j[$]=P}get(j,K){let P=j*this.backward_dimension+K+2;if(this.#j.length<P+1)throw"ConnectionCosts buffer overflow";return this.#j[P]}loadConnectionCosts(j){this.forward_dimension=j[0],this.backward_dimension=j[1],this.#j=j}}var m=d;var O1=new TextEncoder,T1=new TextDecoder;class o{#j;#K=0;get buffer(){return this.#j}set buffer(j){this.#j=j}get position(){return this.#K}set position(j){this.#K=j}constructor(j){if(j===void 0)this.#j=new Uint8Array(1048576),this.#K=0;else if(typeof j==="number")this.#j=new Uint8Array(j),this.#K=0;else if(j instanceof Uint8Array)this.#j=j,this.#K=0;else throw`${typeof j} is invalid parameter type`}size(){return this.#j.length}reallocate(){let j=new Uint8Array(this.#j.length*2);j.set(this.#j),this.#j=j}shrink(){return this.#j=this.#j.subarray(0,this.#K),this.#j}put(j){if(this.#j.length<this.#K+1)this.reallocate();if(typeof j==="boolean")this.#j[this.#K++]=j?1:0;else this.#j[this.#K++]=j}get(j=null){let K=j;if(K==null)K=this.#K,this.#K+=1;if(this.#j.length<K+1)return 0;return this.#j[K]}putShort(j){if(65535<j)throw`${j} is over short value`;let K=255&j,P=(65280&j)>>8;this.put(K),this.put(P)}getShort(j){let K=j;if(K==null)K=this.#K,this.#K+=2;if(this.#j.length<K+2)return 0;let P=this.#j[K],q=(this.#j[K+1]<<8)+P;if(q&32768)q=-(q-1^65535);return q}putInt(j){if(4294967295<j)throw`${j} is over integer value`;let K=255&j,P=(65280&j)>>8,$=(16711680&j)>>16,q=(4278190080&j)>>24;this.put(K),this.put(P),this.put($),this.put(q)}getInt(j=null){let K=j;if(K==null)K=this.#K,this.#K+=4;if(this.#j.length<K+4)return 0;let P=this.#j[K],$=this.#j[K+1],q=this.#j[K+2];return(this.#j[K+3]<<24)+(q<<16)+($<<8)+P}readInt(){let j=this.#K;return this.#K+=4,this.getInt(j)}putString(j){let K=O1.encode(j);for(let P of K)this.put(P);this.put(0)}getString(j=this.#K){let K=j,P=[],$;while(K<this.#j.length){if($=this.get(K++),$===0)break;P.push($)}return this.#K=K,T1.decode(new Uint8Array(P))}getUtf32(j=null){let K=j;if(K==null)K=this.#K,this.#K+=4;if(this.#j.length<K+4)return 0;let P=this.#j.subarray(K,K+4);return new DataView(P.buffer).getUint32(0,!1)}getBool(j=null){let K=j;if(K==null)K=this.#K,this.#K+=1;if(this.#j.length<K+1)return!1;return Boolean(this.#j[K])}}var A=o;class a{dictionary;target_map;pos_buffer;constructor(){this.dictionary=new A(10485760),this.target_map=new Map,this.pos_buffer=new A(10485760)}buildDictionary(j){let K={};for(let P=0;P<j.length;P++){let $=j[P];if($.length<4)continue;let q=$[0],Z=Number.parseInt($[1]),J=Number.parseInt($[2]),Q=Number.parseInt($[3]),X=$.slice(4).join(",");if(!Number.isFinite(Z)||!Number.isFinite(J)||!Number.isFinite(Q))console.log($);let H=this.put(Z,J,Q,q,X);K[H]=q}return this.dictionary.shrink(),this.pos_buffer.shrink(),K}put(j,K,P,$,q){let Z=this.dictionary.position,J=this.pos_buffer.position;return this.dictionary.putShort(j),this.dictionary.putShort(K),this.dictionary.putShort(P),this.dictionary.putInt(J),this.pos_buffer.putString(`${$},${q}`),Z}addMapping(j,K){let P=this.target_map.get(j);if(P==null)P=[];P.push(K),this.target_map.set(j,P)}targetMapToBuffer(){let j=new A;j.putInt(Object.keys(this.target_map).length);for(let K in this.target_map){let P=Number.parseInt(K),$=this.target_map.get(P);if(!$)continue;let q=$.length;j.putInt(P),j.putInt(q);for(let Z of $)j.putInt(Z)}return j.shrink()}loadDictionary(j){return this.dictionary=new A(j),this}loadPosVector(j){return this.pos_buffer=new A(j),this}loadTargetMap(j){let K=new A(j);K.position=0,this.target_map=new Map,K.readInt();while(!0){if(K.buffer.length<K.position+1)break;let P=K.readInt(),$=K.readInt();for(let q=0;q<$;q++){let Z=K.readInt();this.addMapping(P,Z)}}return this}getFeatures(j){if(Number.isNaN(j))return null;let K=this.dictionary.getInt(j+6);return this.pos_buffer.getString(K)}}var N=a;class w{#j;#K;length;constructor(j){this.#j=j,this.#K=[];for(let K=0;K<j.length;K++){let P=j.charAt(K);if(this.#K.push(K),w.isSurrogatePair(P))K++}this.length=this.#K.length}slice(j){if(this.#K.length<=j)return"";let K=this.#K[j];return this.#j.slice(K)}charAt(j){if(this.#j.length<=j)return"";let K=this.#K[j],P=this.#K[j+1];if(P==null)return this.#j.slice(K);return this.#j.slice(K,P)}charCodeAt(j){if(this.#K.length<=j)return Number.NaN;let K=this.#K[j],P=this.#j.charCodeAt(K),$;if(P>=55296&&P<=56319&&K<this.#j.length){if($=this.#j.charCodeAt(K+1),$>=56320&&$<=57343)return(P-55296)*1024+$-56320+65536}return P}toString(){return this.#j}add(j){return new w(this.#j+j.#j)}append(j){return new w(this.#j+j)}static isSurrogatePair(j){let K=j.charCodeAt(0);if(K>=55296&&K<=56319)return!0;return!1}}var h=w;class n{class_id;class_name;is_always_invoke;is_grouping;max_length;constructor(j,K,P,$,q){this.class_id=j,this.class_name=K,this.is_always_invoke=P,this.is_grouping=$,this.max_length=q}}var x=n;class u{#j;#K;constructor(){this.#j=[],this.#K=new Map}static load(j){let K=new u,P=[],$=new A(j);while($.position+1<$.size()){let q=$.getBool(),Z=$.getBool(),J=$.getInt(),Q=$.getString();P.push(new x(P.length,Q,q,Z,J))}return K.init(P),K}init(j){if(j==null)return;let K=j.length;for(let P=0;P<K;P++){let $=j[P];this.#j[P]=$,this.#K.set($.class_name,P)}}getCharacterClass(j){return this.#j[j]}lookup(j){let K=this.#K.get(j);if(K==null)return null;return K}toBuffer(){let j=new A;for(let K=0;K<this.#j.length;K++){let P=this.#j[K];j.put(P.is_always_invoke),j.put(P.is_grouping),j.putInt(P.max_length),j.putString(P.class_name)}return j.shrink(),j.buffer}}var g=u;var s="DEFAULT";class f{character_category_map;compatible_category_map;invoke_definition_map;constructor(){this.character_category_map=new Uint8Array(65536),this.compatible_category_map=new Uint32Array(65536),this.invoke_definition_map=null}load(j,K,P){let $=new f;return $.character_category_map=j,$.compatible_category_map=K,$.invoke_definition_map=g.load(P),$}static parseCharCategory(j,K){let P=K[1],$=Number.parseInt(K[2]),q=Number.parseInt(K[3]),Z=Number.parseInt(K[4]);if(!Number.isFinite($)||$!==0&&$!==1)return console.log(`char.def parse error. INVOKE is 0 or 1 in:${$}`),null;if(!Number.isFinite(q)||q!==0&&q!==1)return console.log(`char.def parse error. GROUP is 0 or 1 in:${q}`),null;if(!Number.isFinite(Z)||Z<0)return console.log(`char.def parse error. LENGTH is 1 to n:${Z}`),null;return new x(j,P,$===1,q===1,Z)}static parseCategoryMapping(j){let K=Number.parseInt(j[1]);if(!Number.isFinite(K)||K<0||K>65535)console.log(`char.def parse error. CODE is invalid:${K}`);return{start:K,default:j[2],compatible:3<j.length?j.slice(3):[]}}static parseRangeCategoryMapping(j){let K=Number.parseInt(j[1]),P=Number.parseInt(j[2]);if(!Number.isFinite(K)||K<0||K>65535)console.log(`char.def parse error. CODE is invalid:${K}`);if(!Number.isFinite(P)||P<0||P>65535)console.log(`char.def parse error. CODE is invalid:${P}`);return{start:K,end:P,default:j[3],compatible:4<j.length?j.slice(4):[]}}initCategoryMappings(j){if(!this.invoke_definition_map)throw new Error("CharacterDefinition.initCategoryMappings: invoke_definition_map is null");let K=0;if(j!=null){let q=j.length;for(let Z=0;Z<q;Z++){let J=j[Z];for(K=J.start;K<=(J.end||J.start);K++){let Q=this.invoke_definition_map.lookup(J.default);if(Q==null)throw new Error("CharacterDefinition.initCategoryMappings: invoke_definition_map.lookup() returns null");this.character_category_map[K]=Q;for(let X=0;X<J.compatible.length;X++){let H=this.compatible_category_map[K],Y=J.compatible[X];if(Y==null)continue;let W=this.invoke_definition_map.lookup(Y);if(W==null)continue;let v=1<<W;H=H|v,this.compatible_category_map[K]=H}}}}let P=this.invoke_definition_map.lookup(s);if(P==null)return;let $=this.compatible_category_map.length;for(K=0;K<$;K++)if(this.character_category_map[K]===0)this.character_category_map[K]=1<<P}lookupCompatibleCategory(j){let K=[];if(!this.invoke_definition_map)throw new Error("CharacterDefinition.lookupCompatibleCategory: invoke_definition_map is null");let P=j.charCodeAt(0),$=null;if(P<this.compatible_category_map.length)$=this.compatible_category_map[P];if($==null||$===0)return K;for(let q=0;q<32;q++)if($<<31-q>>>31===1){let Z=this.invoke_definition_map.getCharacterClass(q);if(Z==null)continue;K.push(Z)}return K}lookup(j){if(!this.invoke_definition_map)throw new Error("CharacterDefinition.lookup: invoke_definition_map is null");let K=null,P=j.charCodeAt(0);if(h.isSurrogatePair(j))K=this.invoke_definition_map.lookup(s);else if(P<this.character_category_map.length)K=this.character_category_map[P];if(K==null)K=this.invoke_definition_map.lookup(s);return this.invoke_definition_map.getCharacterClass(K)}}var I=f;class _ extends N{#j=null;characterDefinition(j){return this.#j=j,this}lookup(j){if(this.#j==null)throw new Error("CharacterDefinition is not set");return this.#j.lookup(j)}lookupCompatibleCategory(j){if(this.#j==null)throw new Error("CharacterDefinition is not set");return this.#j.lookupCompatibleCategory(j)}loadUnknownDictionaries(j,K,P,$,q,Z){this.loadDictionary(j),this.loadPosVector(K),this.loadTargetMap(P),this.#j=new I().load($,q,Z)}}var y=_;class i{trie;token_info_dictionary;connection_costs;unknown_dictionary;constructor(j,K,P,$){this.trie=j??B.builder(0).build([{k:"",v:1}]),this.token_info_dictionary=K??new N,this.connection_costs=P??new m(0,0),this.unknown_dictionary=$??new y}loadTrie(j,K){return this.trie=B.load(j,K),this}loadTokenInfoDictionaries(j,K,P){return this.token_info_dictionary.loadDictionary(j),this.token_info_dictionary.loadPosVector(K),this.token_info_dictionary.loadTargetMap(P),this}loadConnectionCosts(j){return this.connection_costs.loadConnectionCosts(j),this}loadUnknownDictionaries(j,K,P,$,q,Z){return this.unknown_dictionary.loadUnknownDictionaries(j,K,P,$,q,Z),this}}var k=i;var B1=/^(\w+)\s+(\d)\s+(\d)\s+(\d)/,w1=/^(0x[0-9A-F]{4})(?:\s+([^#\s]+))(?:\s+([^#\s]+))*/,C1=/^(0x[0-9A-F]{4})\.\.(0x[0-9A-F]{4})(?:\s+([^#\s]+))(?:\s+([^#\s]+))*/;class r{char_def;character_category_definition;category_mapping;constructor(){this.char_def=new I,this.char_def.invoke_definition_map=new g,this.character_category_definition=[],this.category_mapping=[]}putLine(j){let K=B1.exec(j);if(K!=null){let q=this.character_category_definition.length,Z=I.parseCharCategory(q,K);if(Z==null)return;this.character_category_definition.push(Z);return}let P=w1.exec(j);if(P!=null){let q=I.parseCategoryMapping(P);this.category_mapping.push(q)}let $=C1.exec(j);if($!=null){let q=I.parseRangeCategoryMapping($);this.category_mapping.push(q)}}build(){if(!this.char_def||!this.char_def.invoke_definition_map)throw new Error("No data to build.");return this.char_def.invoke_definition_map.init(this.character_category_definition),this.char_def.initCategoryMappings(this.category_mapping),this.char_def}}var e=r;class j1{lines;connection_cost;constructor(){this.lines=0,this.connection_cost=null}putLine(j){if(this.lines===0||!this.connection_cost){let Z=j.split(" "),J=Number.parseInt(Z[0]),Q=Number.parseInt(Z[1]);if(J<0||Q<0)throw"Parse error of matrix.def";return this.connection_cost=new m(J,Q),this.lines++,this}if(!this.connection_cost)throw"connection_cost is null";let K=j.split(" ");if(K.length!==3)return this;let P=Number.parseInt(K[0]),$=Number.parseInt(K[1]),q=Number.parseInt(K[2]);if(P<0||$<0||!Number.isFinite(P)||!Number.isFinite($)||this.connection_cost.forward_dimension<=P||this.connection_cost.backward_dimension<=$)throw"Parse error of matrix.def";return this.connection_cost.put(P,$,q),this.lines++,this}build(){if(!this.connection_cost)throw"No data to build.";return this.connection_cost}}var K1=j1;class P1{#j;#K;#P;#$;constructor(){this.#j=[],this.#K=[],this.#P=new K1,this.#$=new e}addTokenInfoDictionary(j){let K=j.split(",");return this.#j.push(K),this}putCostMatrixLine(j){return this.#P.putLine(j),this}putCharDefLine(j){return this.#$.putLine(j),this}putUnkDefLine(j){return this.#K.push(j.split(",")),this}build(){let j=this.buildTokenInfoDictionary();return new k(j.trie,j.token_info_dictionary,this.#P.build(),this.buildUnknownDictionary())}buildTokenInfoDictionary(){let j=new N,K=j.buildDictionary(this.#j),P=this.buildDoubleArray();for(let $ in K){let q=K[$],Z=P.lookup(q);j.addMapping(Z,Number.parseInt($))}return{trie:P,token_info_dictionary:j}}buildUnknownDictionary(){let j=new y,K=j.buildDictionary(this.#K),P=this.#$.build();if(!P||!P.invoke_definition_map)throw new Error("CharacterDefinition is not set");j.characterDefinition(P);for(let $ in K){let q=K[$],Z=P.invoke_definition_map.lookup(q);if(!Z)throw new Error(`Class name not found: ${q}`);j.addMapping(Z,Number.parseInt($))}return j}buildDoubleArray(){let j=0,K=this.#j.map(($)=>{return{k:$[0],v:j++}});return B.builder(1048576).build(K)}}var $1=P1;class J1{formatEntry(j,K,P,$){return{word_id:j,word_type:P,word_position:K,surface_form:$[0],pos:$[1],pos_detail_1:$[2],pos_detail_2:$[3],pos_detail_3:$[4],conjugated_type:$[5],conjugated_form:$[6],basic_form:$[7],reading:$[8],pronunciation:$[9]}}formatUnknownEntry(j,K,P,$,q){return{word_id:j,word_type:P,word_position:K,surface_form:q,pos:$[1],pos_detail_1:$[2],pos_detail_2:$[3],pos_detail_3:$[4],conjugated_type:$[5],conjugated_form:$[6],basic_form:$[7]}}}var q1=J1;class Q1{name;cost;start_pos;length;left_id;right_id;prev;surface_form;shortest_cost;type;constructor(j,K,P,$,q,Z,J,Q){this.name=j,this.cost=K,this.start_pos=P,this.length=$,this.left_id=Z,this.right_id=J,this.prev=null,this.surface_form=Q,this.shortest_cost=q==="BOS"?0:Number.MAX_VALUE,this.type=q}}var R=Q1;class X1{nodes_end_at;eos_pos;constructor(){this.nodes_end_at=[],this.nodes_end_at[0]=[new R(-1,0,0,0,"BOS",0,0,"")],this.eos_pos=1}append(j){let K=j.start_pos+j.length-1;if(this.eos_pos<K)this.eos_pos=K;let P=this.nodes_end_at[K]??[];P.push(j),this.nodes_end_at[K]=P}appendEos(){let j=this.nodes_end_at.length;this.eos_pos++,this.nodes_end_at[j]=[new R(-1,0,this.eos_pos,0,"EOS",0,0,"")]}}var Z1=X1;class H1{#j;#K;#P;constructor(j){this.#j=j.trie,this.#K=j.token_info_dictionary,this.#P=j.unknown_dictionary}build(j){let K=new Z1,P=new h(j),$=P.length;for(let q=0;q<$;q++){let Z=P.slice(q),J=this.#j.commonPrefixSearch(Z),Q=J.length;for(let Y=0;Y<Q;Y++){let W=J[Y].v,v=J[Y].k,U=this.#K.target_map.get(W);if(!U)throw new Error("TokenInfo dictionary is broken");for(let G of U){let V=this.#K.dictionary.getShort(G),L=this.#K.dictionary.getShort(G+2),z=this.#K.dictionary.getShort(G+4);K.append(new R(G,z,q+1,v.length,"KNOWN",V,L,v))}}let X=Z.charAt(0),H=this.#P.lookup(X);if(!J?.length||H.is_always_invoke){let Y=X,W=Z.length;if(H.is_grouping&&W>1){let V=H.class_name;for(let L=1;L<W;L++){let z=Z.charAt(L);if(this.#P.lookup(z).class_name!==V)break;Y+=z}}let v=this.#P.target_map.get(H.class_id);if(!v)throw new Error("Unknown dictionary is broken");let U=v.length,G=this.#P.dictionary;for(let V=0;V<U;V++){let L=v[V];K.append(new R(L,G.getShort(L+4),q+1,Y.length,"UNKNOWN",G.getShort(L),G.getShort(L+2),Y))}}}return K.appendEos(),K}}var W1=H1;class Y1{#j;constructor(j){this.#j=j}search(j){let K=j;return K=this.#K(K),this.#P(K)}#K(j){let K=1;for(K=1;K<=j.eos_pos;K++){let P=j.nodes_end_at[K];if(P==null)continue;for(let $ of P){let q=Number.MAX_VALUE,Z=null,J=$.start_pos-1;if(!(J in j.nodes_end_at))continue;let Q=j.nodes_end_at[J];for(let X of Q){let H;if($.left_id==null||X.right_id==null)console.log("Left or right is null"),H=0;else H=this.#j.get(X.right_id,$.left_id);let Y=X.shortest_cost+H+$.cost;if(Y<q)Z=X,q=Y}$.prev=Z,$.shortest_cost=q}}return j}#P(j){let K=[],$=j.nodes_end_at[j.nodes_end_at.length-1][0].prev;if($==null)return[];while($.type!=="BOS"){if(K.push($),$.prev==null)return[];$=$.prev}return K.reverse()}}var v1=Y1;class c{#j;#K;#P;#$;#J;constructor(j){this.#j=j.token_info_dictionary,this.#K=j.unknown_dictionary,this.#P=new W1(j),this.#$=new v1(j.connection_costs),this.#J=new q1}static splitByPunctuation(j){let K=j.matchAll(/、|。/g),P=[],$=0;for(let q of K){let Z=q.index;P.push(j.slice($,Z+1)),$=Z+1}if($<j.length)P.push(j.slice($));return P}tokenize(j){let K=c.splitByPunctuation(j),P=[];for(let $ of K)this.#q($,P);return P}#q(j,K=[]){let P=this.#P.build(j),$=this.#$.search(P),q=K.length>0?K[K.length-1].word_position:0;for(let Z of $)K.push(this.#Q(Z,q));return K}#Q(j,K){let P=j.type==="KNOWN"?this.#j.getFeatures(j.name):this.#K.getFeatures(j.name),$=P?P.split(","):[];if(j.type==="UNKNOWN")return this.#J.formatUnknownEntry(j.name,K+j.start_pos,j.type,$,j.surface_form);return this.#J.formatEntry(j.name,K+j.start_pos,j.type,$)}}var U1=c;var{create:D1,defineProperty:V1,getOwnPropertyDescriptor:m1,getOwnPropertyNames:h1,getPrototypeOf:x1}=Object,g1=Object.prototype.hasOwnProperty,y1=(j,K)=>()=>(K||j((K={exports:{}}).exports,K),K.exports),k1=(j,K,P,$)=>{if(K&&typeof K=="object"||typeof K=="function")for(let q of h1(K))!g1.call(j,q)&&q!==P&&V1(j,q,{get:()=>K[q],enumerable:!($=m1(K,q))||$.enumerable});return j},p1=(j,K,P)=>(P=j!=null?D1(x1(j)):{},k1(K||!j||!j.__esModule?V1(P,"default",{value:j,enumerable:!0}):P,j)),l1=y1((j,K)=>{function P(J){if(typeof J!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(J))}function $(J,Q){for(var X="",H=0,Y=-1,W=0,v,U=0;U<=J.length;++U){if(U<J.length)v=J.charCodeAt(U);else{if(v===47)break;v=47}if(v===47){if(!(Y===U-1||W===1))if(Y!==U-1&&W===2){if(X.length<2||H!==2||X.charCodeAt(X.length-1)!==46||X.charCodeAt(X.length-2)!==46){if(X.length>2){var G=X.lastIndexOf("/");if(G!==X.length-1){G===-1?(X="",H=0):(X=X.slice(0,G),H=X.length-1-X.lastIndexOf("/")),Y=U,W=0;continue}}else if(X.length===2||X.length===1){X="",H=0,Y=U,W=0;continue}}Q&&(X.length>0?X+="/..":X="..",H=2)}else X.length>0?X+="/"+J.slice(Y+1,U):X=J.slice(Y+1,U),H=U-Y-1;Y=U,W=0}else v===46&&W!==-1?++W:W=-1}return X}function q(J,Q){var X=Q.dir||Q.root,H=Q.base||(Q.name||"")+(Q.ext||"");return X?X===Q.root?X+H:X+J+H:H}var Z={resolve:function(){for(var J="",Q=!1,X,H=arguments.length-1;H>=-1&&!Q;H--){var Y;H>=0?Y=arguments[H]:(X===void 0&&(X=process.cwd()),Y=X),P(Y),Y.length!==0&&(J=Y+"/"+J,Q=Y.charCodeAt(0)===47)}return J=$(J,!Q),Q?J.length>0?"/"+J:"/":J.length>0?J:"."},normalize:function(J){if(P(J),J.length===0)return".";var Q=J.charCodeAt(0)===47,X=J.charCodeAt(J.length-1)===47;return J=$(J,!Q),J.length===0&&!Q&&(J="."),J.length>0&&X&&(J+="/"),Q?"/"+J:J},isAbsolute:function(J){return P(J),J.length>0&&J.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var J,Q=0;Q<arguments.length;++Q){var X=arguments[Q];P(X),X.length>0&&(J===void 0?J=X:J+="/"+X)}return J===void 0?".":Z.normalize(J)},relative:function(J,Q){if(P(J),P(Q),J===Q||(J=Z.resolve(J),Q=Z.resolve(Q),J===Q))return"";for(var X=1;X<J.length&&J.charCodeAt(X)===47;++X);for(var H=J.length,Y=H-X,W=1;W<Q.length&&Q.charCodeAt(W)===47;++W);for(var v=Q.length,U=v-W,G=Y<U?Y:U,V=-1,L=0;L<=G;++L){if(L===G){if(U>G){if(Q.charCodeAt(W+L)===47)return Q.slice(W+L+1);if(L===0)return Q.slice(W+L)}else Y>G&&(J.charCodeAt(X+L)===47?V=L:L===0&&(V=0));break}var z=J.charCodeAt(X+L),R1=Q.charCodeAt(W+L);if(z!==R1)break;z===47&&(V=L)}var O="";for(L=X+V+1;L<=H;++L)(L===H||J.charCodeAt(L)===47)&&(O.length===0?O+="..":O+="/..");return O.length>0?O+Q.slice(W+V):(W+=V,Q.charCodeAt(W)===47&&++W,Q.slice(W))},_makeLong:function(J){return J},dirname:function(J){if(P(J),J.length===0)return".";for(var Q=J.charCodeAt(0),X=Q===47,H=-1,Y=!0,W=J.length-1;W>=1;--W)if(Q=J.charCodeAt(W),Q===47){if(!Y){H=W;break}}else Y=!1;return H===-1?X?"/":".":X&&H===1?"//":J.slice(0,H)},basename:function(J,Q){if(Q!==void 0&&typeof Q!="string")throw new TypeError('"ext" argument must be a string');P(J);var X=0,H=-1,Y=!0,W;if(Q!==void 0&&Q.length>0&&Q.length<=J.length){if(Q.length===J.length&&Q===J)return"";var v=Q.length-1,U=-1;for(W=J.length-1;W>=0;--W){var G=J.charCodeAt(W);if(G===47){if(!Y){X=W+1;break}}else U===-1&&(Y=!1,U=W+1),v>=0&&(G===Q.charCodeAt(v)?--v===-1&&(H=W):(v=-1,H=U))}return X===H?H=U:H===-1&&(H=J.length),J.slice(X,H)}else{for(W=J.length-1;W>=0;--W)if(J.charCodeAt(W)===47){if(!Y){X=W+1;break}}else H===-1&&(Y=!1,H=W+1);return H===-1?"":J.slice(X,H)}},extname:function(J){P(J);for(var Q=-1,X=0,H=-1,Y=!0,W=0,v=J.length-1;v>=0;--v){var U=J.charCodeAt(v);if(U===47){if(!Y){X=v+1;break}continue}H===-1&&(Y=!1,H=v+1),U===46?Q===-1?Q=v:W!==1&&(W=1):Q!==-1&&(W=-1)}return Q===-1||H===-1||W===0||W===1&&Q===H-1&&Q===X+1?"":J.slice(Q,H)},format:function(J){if(J===null||typeof J!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof J);return q("/",J)},parse:function(J){P(J);var Q={root:"",dir:"",base:"",ext:"",name:""};if(J.length===0)return Q;var X=J.charCodeAt(0),H=X===47,Y;H?(Q.root="/",Y=1):Y=0;for(var W=-1,v=0,U=-1,G=!0,V=J.length-1,L=0;V>=Y;--V){if(X=J.charCodeAt(V),X===47){if(!G){v=V+1;break}continue}U===-1&&(G=!1,U=V+1),X===46?W===-1?W=V:L!==1&&(L=1):W!==-1&&(L=-1)}return W===-1||U===-1||L===0||L===1&&W===U-1&&W===v+1?U!==-1&&(v===0&&H?Q.base=Q.name=J.slice(1,U):Q.base=Q.name=J.slice(v,U)):(v===0&&H?(Q.name=J.slice(1,W),Q.base=J.slice(1,U)):(Q.name=J.slice(v,W),Q.base=J.slice(v,U)),Q.ext=J.slice(W,U)),v>0?Q.dir=J.slice(0,v-1):H&&(Q.dir="/"),Q},sep:"/",delimiter:":",win32:null,posix:null};Z.posix=Z,K.exports=Z}),E1=p1(l1()),E=E1,b1=E1,L1=function(j){return j},F1=function(){throw new Error("Not implemented")};E.parse??=F1;b1.parse??=F1;var S={resolve:E.resolve.bind(E),normalize:E.normalize.bind(E),isAbsolute:E.isAbsolute.bind(E),join:E.join.bind(E),relative:E.relative.bind(E),toNamespacedPath:L1,dirname:E.dirname.bind(E),basename:E.basename.bind(E),extname:E.extname.bind(E),format:E.format.bind(E),parse:E.parse.bind(E),sep:"/",delimiter:":",win32:void 0,posix:void 0,_makeLong:L1},G1={sep:"\\",delimiter:";",win32:void 0,...S,posix:S};S.win32=G1.win32=G1;S.posix=S;var M1=S;class A1{#j;#K;constructor(j="dict/"){this.#j=new k,this.#K=j}async#P(j){let K=new DecompressionStream("gzip"),P=new Blob([j]).stream().pipeThrough(K);return await new Response(P).arrayBuffer()}#$=(j)=>new Promise((K,P)=>{fetch(j).then(async($)=>await $.arrayBuffer()).then(async($)=>{let q=await this.#P($);K(q)}).catch(($)=>{P($)})});load(j){Promise.all(["base.dat.gz","check.dat.gz","tid.dat.gz","tid_pos.dat.gz","tid_map.dat.gz","cc.dat.gz","unk.dat.gz","unk_pos.dat.gz","unk_map.dat.gz","unk_char.dat.gz","unk_compat.dat.gz","unk_invoke.dat.gz"].map((K)=>this.#$(M1.join(this.#K,K)))).then((K)=>{this.#j.loadTrie(new Int32Array(K[0]),new Int32Array(K[1])),this.#j.loadTokenInfoDictionaries(new Uint8Array(K[2]),new Uint8Array(K[3]),new Uint8Array(K[4])),this.#j.loadConnectionCosts(new Int16Array(K[5])),this.#j.loadUnknownDictionaries(new Uint8Array(K[6]),new Uint8Array(K[7]),new Uint8Array(K[8]),new Uint8Array(K[9]),new Uint32Array(K[10]),new Uint8Array(K[11])),j(null,this.#j)}).catch((K)=>{j(K,this.#j)})}}var z1=A1;class I1{#j;constructor(j={}){this.#j=new z1(j.dicPath)}build(j){this.#j.load((K,P)=>{j(K,new U1(P))})}}var N1=I1;var t0={builder:(j={})=>{return new N1(j)},dictionaryBuilder:()=>{return new $1}};export{t0 as default,N1 as TokenizerBuilder,$1 as DictionaryBuilder};

//# debugId=894D4E5A1EC2FF3064756E2164756E21
//# sourceMappingURL=index.min.js.map
