// @bun
class p{formatEntry(K,U,X,q){return{word_id:K,word_type:X,word_position:U,surface_form:q[0],pos:q[1],pos_detail_1:q[2],pos_detail_2:q[3],pos_detail_3:q[4],conjugated_type:q[5],conjugated_form:q[6],basic_form:q[7],reading:q[8],pronunciation:q[9]}}formatUnknownEntry(K,U,X,q,H){return{word_id:K,word_type:X,word_position:U,surface_form:H,pos:q[1],pos_detail_1:q[2],pos_detail_2:q[3],pos_detail_3:q[4],conjugated_type:q[5],conjugated_form:q[6],basic_form:q[7]}}}var b=p;class R{str;#K;length;constructor(K){this.str=K,this.#K=[];let U=K.length;for(let X=0;X<U;X++){let q=K.charAt(X);if(this.#K.push(X),R.isSurrogatePair(q))X++}this.length=this.#K.length}slice(K){if(this.#K.length<=K)return"";let U=this.#K[K];return this.str.slice(U)}charAt(K){if(this.str.length<=K)return"";let U=this.#K[K],X=this.#K[K+1];if(X==null)return this.str.slice(U);return this.str.slice(U,X)}charCodeAt(K){if(this.#K.length<=K)return Number.NaN;let U=this.#K[K],X=this.str.charCodeAt(U),q;if(X>=55296&&X<=56319&&U<this.str.length){if(q=this.str.charCodeAt(U+1),q>=56320&&q<=57343)return(X-55296)*1024+q-56320+65536}return X}toString(){return this.str}add(K){return new R(this.str+K.str)}append(K){return new R(this.str+K)}static isSurrogatePair(K){let U=K.charCodeAt(0);if(U>=55296&&U<=56319)return!0;return!1}}var z=R;class l{name;cost;start_pos;length;left_id;right_id;prev;surface_form;shortest_cost;type;constructor(K,U,X,q,H,J,Q,Z){this.name=K,this.cost=U,this.start_pos=X,this.length=q,this.left_id=J,this.right_id=Q,this.prev=null,this.surface_form=Z,this.shortest_cost=H==="BOS"?0:Number.MAX_VALUE,this.type=H}}var L=l;class u{nodes_end_at;eos_pos;constructor(){this.nodes_end_at=[],this.nodes_end_at[0]=[new L(-1,0,0,0,"BOS",0,0,"")],this.eos_pos=1}append(K){let U=K.start_pos+K.length-1;if(this.eos_pos<U)this.eos_pos=U;let X=this.nodes_end_at[U]??[];X.push(K),this.nodes_end_at[U]=X}appendEos(){let K=this.nodes_end_at.length;this.eos_pos++,this.nodes_end_at[K]=[new L(-1,0,this.eos_pos,0,"EOS",0,0,"")]}}var f=u;class s{#K;#U;#X;constructor(K){this.#K=K.trie,this.#U=K.token_info_dictionary,this.#X=K.unknown_dictionary}build(K){let U=new f,X=new z(K),q=X.length;for(let H=0;H<q;H++){let J=X.slice(H),Q=this.#K.commonPrefixSearch(J),Z=Q.length;for(let W=0;W<Z;W++){let F=Q[W].v,N=Q[W].k,I=this.#U.target_map.get(F);if(!I)throw new Error("TokenInfo dictionary is broken");for(let G of I){let O=this.#U.dictionary.getShort(G),Y=this.#U.dictionary.getShort(G+2),T=this.#U.dictionary.getShort(G+4);U.append(new L(G,T,H+1,N.length,"KNOWN",O,Y,N))}}let $=J.charAt(0),P=this.#X.lookup($);if(!Q?.length||P.is_always_invoke){let W=$,F=J.length;if(P.is_grouping&&F>1){let O=P.class_name;for(let Y=1;Y<F;Y++){let T=J.charAt(Y);if(this.#X.lookup(T).class_name!==O)break;W+=T}}let N=this.#X.target_map.get(P.class_id);if(!N)throw new Error("Unknown dictionary is broken");let I=N.length,G=this.#X.dictionary;for(let O=0;O<I;O++){let Y=N[O];U.append(new L(Y,G.getShort(Y+4),H+1,W.length,"UNKNOWN",G.getShort(Y),G.getShort(Y+2),W))}}}return U.appendEos(),U}}var c=s;class d{#K;constructor(K){this.#K=K}search(K){let U=K;return U=this.#U(U),this.#X(U)}#U(K){let U=1;for(U=1;U<=K.eos_pos;U++){let X=K.nodes_end_at[U];if(X==null)continue;for(let q of X){let H=Number.MAX_VALUE,J=null,Q=q.start_pos-1;if(!(Q in K.nodes_end_at))continue;let Z=K.nodes_end_at[Q];for(let $ of Z){let P;if(q.left_id==null||$.right_id==null)console.log("Left or right is null"),P=0;else P=this.#K.get($.right_id,q.left_id);let W=$.shortest_cost+P+q.cost;if(W<H)J=$,H=W}q.prev=J,q.shortest_cost=H}}return K}#X(K){let U=[],q=K.nodes_end_at[K.nodes_end_at.length-1][0].prev;if(q==null)return[];while(q.type!=="BOS"){if(U.push(q),q.prev==null)return[];q=q.prev}return U.reverse()}}var o=d;class S{static#K=/\u3001|\u3002/g;#U;#X;#q;#J;#H;constructor(K){this.#U=K.token_info_dictionary,this.#X=K.unknown_dictionary,this.#q=new c(K),this.#J=new o(K.connection_costs),this.#H=new b}static splitByPunctuation(K){let U=K.matchAll(S.#K),X=[],q=0;for(let H of U){let J=H.index;X.push(K.slice(q,J+1)),q=J+1}if(q<K.length)X.push(K.slice(q));return X}tokenize(K){let U=S.splitByPunctuation(K),X=[];for(let q of U)this.#Q(q,X);return X}#Q(K,U=[]){let X=this.#$(K),q=this.#J.search(X),H=U.length>0?U[U.length-1].word_position:0,J=q.length;for(let Q=0;Q<J;Q++){let Z=q[Q],$=this.#Z(Z,H);U.push($)}return U}#Z(K,U){if(K.type==="KNOWN"){let X=this.#U.getFeatures(K.name),q=X==null?[]:X.split(",");return this.#H.formatEntry(K.name,U+K.start_pos,K.type,q)}if(K.type==="UNKNOWN"){let X=this.#X.getFeatures(K.name),q=X==null?[]:X.split(",");return this.#H.formatUnknownEntry(K.name,U+K.start_pos,K.type,q,K.surface_form)}return this.#H.formatEntry(K.name,U+K.start_pos,K.type,[])}#$(K){return this.#q.build(K)}}var t=S;import{existsSync as OK,readFileSync as MK}from"fs";import LK from"path";import VK from"zlib";var B=new TextEncoder,FK=new TextDecoder,A=(K,U,X)=>{if(K)switch(U){case 1:return new Int8Array(X);case 2:return new Int16Array(X);case 4:return new Int32Array(X);default:throw new RangeError(`Invalid newArray parameter element_bytes:${U}`)}switch(U){case 1:return new Uint8Array(X);case 2:return new Uint16Array(X);case 4:return new Uint32Array(X);default:throw new RangeError(`Invalid newArray parameter element_bytes:${U}`)}},NK=(K,U,X)=>{return K.slice(U,U+X)};class h{#K;#U;#X;constructor(K=1024){if(this.#K=1,this.#U={signed:!0,bytes:4,array:A(!0,4,K)},this.#X={signed:!0,bytes:4,array:A(!0,4,K)},!this.#U.array||!this.#X.array)throw new Error("Initialization failed: Arrays are null");this.#U.array[0]=1,this.#X.array[0]=0,this.initBase(this.#U.array,1,this.#U.array.length),this.initCheck(this.#X.array,1,this.#X.array.length)}initBase(K,U,X){if(!this.#U.array||!this.#X.array)throw new Error("initBase() failed: Arrays not initialized");for(let q=U;q<X;q++)K[q]=-q+1;if(0<this.#X.array[this.#X.array.length-1]){let q=this.#X.array.length-2;while(0<this.#X.array[q])q--;K[U]=-q}}initCheck(K,U,X){for(let q=U;q<X;q++)K[q]=-q-1}realloc(K){if(!this.#U.array||!this.#X.array)throw new Error("initBase() failed: Arrays not initialized");let U=K*2,X=A(this.#U.signed,this.#U.bytes,U);this.initBase(X,this.#U.array.length,U),X.set(this.#U.array),this.#U.array=X;let q=A(this.#X.signed,this.#X.bytes,U);this.initCheck(q,this.#X.array.length,U),q.set(this.#X.array),this.#X.array=q}getBaseBuffer(){return this.#U.array}getCheckBuffer(){return this.#X.array}loadBaseBuffer(K){return this.#U.array=K,this}loadCheckBuffer(K){return this.#X.array=K,this}size(){if(!this.#U.array||!this.#X.array)throw new Error("failed: Arrays not initialized");return Math.max(this.#U.array.length,this.#X.array.length)}getBase(K){if(!this.#U.array)throw new Error("failed: Arrays not initialized");if(this.#U.array.length-1<K)return-K+1;return this.#U.array[K]}getCheck(K){if(!this.#X.array)throw new Error("failed: Arrays not initialized");if(this.#X.array.length-1<K)return-K-1;return this.#X.array[K]}setBase(K,U){if(!this.#U.array)throw new Error("failed: Arrays not initialized");if(this.#U.array.length-1<K)this.realloc(K);this.#U.array[K]=U}setCheck(K,U){if(!this.#X.array)throw new Error("failed: Arrays not initialized");if(this.#X.array.length-1<K)this.realloc(K);this.#X.array[K]=U}setFirstUnusedNode(K){this.#K=K}getFirstUnusedNode(){return this.#K}shrink(){if(!this.#U.array||!this.#X.array)throw new Error("failed: Arrays not initialized");let K=Math.max(this.#U.array.length,this.#X.array.length)-1;while(0<=this.#X.array[K])K--;this.#U.array=this.#U.array.subarray(0,K+2),this.#X.array=this.#X.array.subarray(0,K+2)}calc(){if(!this.#U.array||!this.#X.array)throw new Error("failed: Arrays not initialized");let K=0,U=this.#X.array.length;for(let X=0;X<U;X++)if(this.#X.array[X]<0)K++;return{all:U,unused:K,efficiency:(U-K)/U}}dump(){if(!this.#U.array||!this.#X.array)throw new Error("failed: Arrays not initialized");let K="",U="";for(let X of this.#U.array)K+=` ${X}`;for(let X of this.#X.array)U+=` ${X}`;return console.log(`base:${K}`),console.log(`check:${U}`),`base:${K} check:${U}`}}class _{#K;#U;constructor(K=1024){this.#K=new h(K),this.#U=[]}append(K,U){return this.#U.push({k:K,v:U}),this}build(K=this.#U,U=!1){if(K==null)return new D(this.#K);let X=K.map((q)=>{return{k:B.encode(q.k+"\x00"),v:q.v}});if(U)this.#U=X;else this.#U=X.sort((q,H)=>{let J=q.k,Q=H.k,Z=Math.min(J.length,Q.length);for(let $=0;$<Z;$++){if(J[$]===Q[$])continue;return J[$]-Q[$]}return J.length-Q.length});return this.#X(0,0,0,this.#U.length),new D(this.#K)}#X(K,U,X,q){let H=this.getChildrenInfo(U,X,q),J=this.findAllocatableBase(H);this.setBufferController(K,H,J);for(let Q=0;Q<H.length;Q=Q+3){let Z=H[Q];if(Z===0)continue;let $=H[Q+1],P=H[Q+2],W=J+Z;this.#X(W,U+1,$,P)}}getChildrenInfo(K,U,X){let q=this.#U[U].k[K],H=new Int32Array(X*3),J=0;H[J++]=Number.parseInt(`${q}`),H[J++]=U;let Q=U,Z=U;for(;Q<U+X;Q++){let $=this.#U[Q].k[K];if(q!==$)H[J++]=Q-Z,H[J++]=Number.parseInt(`${$}`),H[J++]=Q,q=$,Z=Q}return H[J++]=Q-Z,H=H.subarray(0,J),H}setBufferController(K,U,X){let q=this.#K;q.setBase(K,X);for(let H=0;H<U.length;H=H+3){let J=U[H],Q=X+J,Z=-q.getBase(Q),$=-q.getCheck(Q);if(Q!==q.getFirstUnusedNode())q.setCheck(Z,-$);else q.setFirstUnusedNode($);q.setBase($,-Z);let P=K;if(q.setCheck(Q,P),J===0){let W=U[H+1],F=this.#U[W].v;if(F==null)F=0;let N=-F-1;q.setBase(Q,N)}}}findAllocatableBase(K){let U=this.#K,X,q=U.getFirstUnusedNode();while(!0){if(X=q-K[0],X<0){q=-U.getCheck(q);continue}let H=!0;for(let J=0;J<K.length;J=J+3){let Q=K[J],Z=X+Q;if(!this.isUnusedNode(Z)){q=-U.getCheck(q),H=!1;break}}if(H)return X}}isUnusedNode(K){let X=this.#K.getCheck(K);if(K===0)return!1;if(X<0)return!0;return!1}}class D{#K;constructor(K){this.#K=K,this.#K.shrink()}contain(K){let U=K,X=this.#K;U+="\x00";let q=B.encode(U),H=0,J=-1;for(let Q=0;Q<q.length;Q++){let Z=q[Q];if(J=this.traverse(H,Z),J===-1)return!1;if(X.getBase(J)<=0)return!0;H=J}return!1}lookup(K){let U=K;U+="\x00";let X=B.encode(U),q=0,H=-1;for(let Q=0;Q<X.length;Q++){let Z=X[Q];if(H=this.traverse(q,Z),H===-1)return-1;q=H}let J=this.#K.getBase(H);if(J<=0)return-J-1;return-1}commonPrefixSearch(K){let U=B.encode(K),X=[],q=0,H=-1;for(let J=0;J<U.length;J++){let Q=U[J];if(H=this.traverse(q,Q),H!==-1){q=H;let Z=this.traverse(H,0);if(Z!==-1){let $=this.#K.getBase(Z),P={k:"",v:0};if($<=0)P.v=-$-1;P.k=FK.decode(NK(U,0,J+1)),X.push(P)}continue}break}return X}traverse(K,U){let X=this.#K.getBase(K)+U;if(this.#K.getCheck(X)===K)return X;return-1}size(){return this.#K.size()}calc(){return this.#K.calc()}dump(){return this.#K.dump()}}var YK={builder:(K=1024)=>{return new _(K)},load:(K,U)=>{let X=new h(0);return X.loadBaseBuffer(K),X.loadCheckBuffer(U),new D(X)}};var j=YK;class n{forward_dimension;backward_dimension;#K;constructor(K,U){this.forward_dimension=K,this.backward_dimension=U,this.#K=new Int16Array(K*U+2),this.#K[0]=K,this.#K[1]=U}put(K,U,X){let q=K*this.backward_dimension+U+2;if(this.#K.length<q+1)throw"ConnectionCosts buffer overflow";this.#K[q]=X}get(K,U){let X=K*this.backward_dimension+U+2;if(this.#K.length<X+1)throw"ConnectionCosts buffer overflow";return this.#K[X]}loadConnectionCosts(K){this.forward_dimension=K[0],this.backward_dimension=K[1],this.#K=K}}var v=n;var EK=new TextEncoder,GK=new TextDecoder;class a{buffer;position=0;constructor(K){if(K===void 0)this.buffer=new Uint8Array(1048576),this.position=0;else if(typeof K==="number")this.buffer=new Uint8Array(K),this.position=0;else if(K instanceof Uint8Array)this.buffer=K,this.position=0;else throw`${typeof K} is invalid parameter type for ByteBuffer constructor`}size(){return this.buffer.length}reallocate(){let K=new Uint8Array(this.buffer.length*2);K.set(this.buffer),this.buffer=K}shrink(){return this.buffer=this.buffer.subarray(0,this.position),this.buffer}put(K){if(this.buffer.length<this.position+1)this.reallocate();if(typeof K==="boolean")this.buffer[this.position++]=K?1:0;else this.buffer[this.position++]=K}get(K=null){let U=K;if(U==null)U=this.position,this.position+=1;if(this.buffer.length<U+1)return 0;return this.buffer[U]}putShort(K){if(65535<K)throw`${K} is over short value`;let U=255&K,X=(65280&K)>>8;this.put(U),this.put(X)}getShort(K){let U=K;if(U==null)U=this.position,this.position+=2;if(this.buffer.length<U+2)return 0;let X=this.buffer[U],H=(this.buffer[U+1]<<8)+X;if(H&32768)H=-(H-1^65535);return H}putInt(K){if(4294967295<K)throw`${K} is over integer value`;let U=255&K,X=(65280&K)>>8,q=(16711680&K)>>16,H=(4278190080&K)>>24;this.put(U),this.put(X),this.put(q),this.put(H)}getInt(K=null){let U=K;if(U==null)U=this.position,this.position+=4;if(this.buffer.length<U+4)return 0;let X=this.buffer[U],q=this.buffer[U+1],H=this.buffer[U+2];return(this.buffer[U+3]<<24)+(H<<16)+(q<<8)+X}readInt(){let K=this.position;return this.position+=4,this.getInt(K)}putString(K){let U=EK.encode(K);if(!U)throw new Error("bytes null.");for(let X of U)this.put(X);this.put(0)}getString(K=this.position){let U=K,X=[],q;while(U<this.buffer.length){if(q=this.get(U++),q===0)break;X.push(q)}return this.position=U,GK.decode(new Uint8Array(X))}getUtf32(K=null){let U=K;if(U==null)U=this.position,this.position+=4;if(this.buffer.length<U+4)return 0;let X=this.buffer.subarray(U,U+4);return new DataView(X.buffer).getUint32(0,!1)}getBool(K=null){let U=K;if(U==null)U=this.position,this.position+=1;if(this.buffer.length<U+1)return!1;return Boolean(this.buffer[U])}}var E=a;class i{dictionary;target_map;pos_buffer;constructor(){this.dictionary=new E(10485760),this.target_map=new Map,this.pos_buffer=new E(10485760)}buildDictionary(K){let U={};for(let X=0;X<K.length;X++){let q=K[X];if(q.length<4)continue;let H=q[0],J=Number.parseInt(q[1]),Q=Number.parseInt(q[2]),Z=Number.parseInt(q[3]),$=q.slice(4).join(",");if(!Number.isFinite(J)||!Number.isFinite(Q)||!Number.isFinite(Z))console.log(q);let P=this.put(J,Q,Z,H,$);U[P]=H}return this.dictionary.shrink(),this.pos_buffer.shrink(),U}put(K,U,X,q,H){let J=this.dictionary.position,Q=this.pos_buffer.position;return this.dictionary.putShort(K),this.dictionary.putShort(U),this.dictionary.putShort(X),this.dictionary.putInt(Q),this.pos_buffer.putString(`${q},${H}`),J}addMapping(K,U){let X=this.target_map.get(K);if(X==null)X=[];X.push(U),this.target_map.set(K,X)}targetMapToBuffer(){let K=new E;K.putInt(Object.keys(this.target_map).length);for(let U in this.target_map){let X=Number.parseInt(U),q=this.target_map.get(X);if(!q)continue;let H=q.length;K.putInt(X),K.putInt(H);for(let J of q)K.putInt(J)}return K.shrink()}loadDictionary(K){return this.dictionary=new E(K),this}loadPosVector(K){return this.pos_buffer=new E(K),this}loadTargetMap(K){let U=new E(K);U.position=0,this.target_map=new Map,U.readInt();while(!0){if(U.buffer.length<U.position+1)break;let X=U.readInt(),q=U.readInt();for(let H=0;H<q;H++){let J=U.readInt();this.addMapping(X,J)}}return this}getFeatures(K){if(Number.isNaN(K))return null;let U=this.dictionary.getInt(K+6);return this.pos_buffer.getString(U)}}var V=i;class r{class_id;class_name;is_always_invoke;is_grouping;max_length;constructor(K,U,X,q,H){this.class_id=K,this.class_name=U,this.is_always_invoke=X,this.is_grouping=q,this.max_length=H}}var C=r;class y{#K;#U;constructor(){this.#K=[],this.#U=new Map}static load(K){let U=new y,X=[],q=new E(K);while(q.position+1<q.size()){let H=q.getBool(),J=q.getBool(),Q=q.getInt(),Z=q.getString();X.push(new C(X.length,Z,H,J,Q))}return U.init(X),U}init(K){if(K==null)return;let U=K.length;for(let X=0;X<U;X++){let q=K[X];this.#K[X]=q,this.#U.set(q.class_name,X)}}getCharacterClass(K){return this.#K[K]}lookup(K){let U=this.#U.get(K);if(U==null)return null;return U}toBuffer(){let K=new E;for(let U=0;U<this.#K.length;U++){let X=this.#K[U];K.put(X.is_always_invoke),K.put(X.is_grouping),K.putInt(X.max_length),K.putString(X.class_name)}return K.shrink(),K.buffer}}var w=y;var k="DEFAULT";class g{character_category_map;compatible_category_map;invoke_definition_map;constructor(){this.character_category_map=new Uint8Array(65536),this.compatible_category_map=new Uint32Array(65536),this.invoke_definition_map=null}load(K,U,X){let q=new g;return q.character_category_map=K,q.compatible_category_map=U,q.invoke_definition_map=w.load(X),q}static parseCharCategory(K,U){let X=U[1],q=Number.parseInt(U[2]),H=Number.parseInt(U[3]),J=Number.parseInt(U[4]);if(!Number.isFinite(q)||q!==0&&q!==1)return console.log(`char.def parse error. INVOKE is 0 or 1 in:${q}`),null;if(!Number.isFinite(H)||H!==0&&H!==1)return console.log(`char.def parse error. GROUP is 0 or 1 in:${H}`),null;if(!Number.isFinite(J)||J<0)return console.log(`char.def parse error. LENGTH is 1 to n:${J}`),null;return new C(K,X,q===1,H===1,J)}static parseCategoryMapping(K){let U=Number.parseInt(K[1]);if(!Number.isFinite(U)||U<0||U>65535)console.log(`char.def parse error. CODE is invalid:${U}`);return{start:U,default:K[2],compatible:3<K.length?K.slice(3):[]}}static parseRangeCategoryMapping(K){let U=Number.parseInt(K[1]),X=Number.parseInt(K[2]);if(!Number.isFinite(U)||U<0||U>65535)console.log(`char.def parse error. CODE is invalid:${U}`);if(!Number.isFinite(X)||X<0||X>65535)console.log(`char.def parse error. CODE is invalid:${X}`);return{start:U,end:X,default:K[3],compatible:4<K.length?K.slice(4):[]}}initCategoryMappings(K){if(!this.invoke_definition_map)throw new Error("CharacterDefinition.initCategoryMappings: invoke_definition_map is null");let U=0;if(K!=null){let H=K.length;for(let J=0;J<H;J++){let Q=K[J];for(U=Q.start;U<=(Q.end||Q.start);U++){let Z=this.invoke_definition_map.lookup(Q.default);if(Z==null)throw new Error("CharacterDefinition.initCategoryMappings: invoke_definition_map.lookup() returns null");this.character_category_map[U]=Z;for(let $=0;$<Q.compatible.length;$++){let P=this.compatible_category_map[U],W=Q.compatible[$];if(W==null)continue;let F=this.invoke_definition_map.lookup(W);if(F==null)continue;let N=1<<F;P=P|N,this.compatible_category_map[U]=P}}}}let X=this.invoke_definition_map.lookup(k);if(X==null)return;let q=this.compatible_category_map.length;for(U=0;U<q;U++)if(this.character_category_map[U]===0)this.character_category_map[U]=1<<X}lookupCompatibleCategory(K){let U=[];if(!this.invoke_definition_map)throw new Error("CharacterDefinition.lookupCompatibleCategory: invoke_definition_map is null");let X=K.charCodeAt(0),q=null;if(X<this.compatible_category_map.length)q=this.compatible_category_map[X];if(q==null||q===0)return U;for(let H=0;H<32;H++)if(q<<31-H>>>31===1){let J=this.invoke_definition_map.getCharacterClass(H);if(J==null)continue;U.push(J)}return U}lookup(K){if(!this.invoke_definition_map)throw new Error("CharacterDefinition.lookup: invoke_definition_map is null");let U=null,X=K.charCodeAt(0);if(z.isSurrogatePair(K))U=this.invoke_definition_map.lookup(k);else if(X<this.character_category_map.length)U=this.character_category_map[X];if(U==null)U=this.invoke_definition_map.lookup(k);return this.invoke_definition_map.getCharacterClass(U)}}var M=g;class e extends V{#K=null;characterDefinition(K){return this.#K=K,this}lookup(K){if(this.#K==null)throw new Error("CharacterDefinition is not set");return this.#K.lookup(K)}lookupCompatibleCategory(K){if(this.#K==null)throw new Error("CharacterDefinition is not set");return this.#K.lookupCompatibleCategory(K)}loadUnknownDictionaries(K,U,X,q,H,J){this.loadDictionary(K),this.loadPosVector(U),this.loadTargetMap(X),this.#K=new M().load(q,H,J)}}var x=e;class KK{trie;token_info_dictionary;connection_costs;unknown_dictionary;constructor(K,U,X,q){this.trie=K??j.builder(0).build([{k:"",v:1}]),this.token_info_dictionary=U??new V,this.connection_costs=X??new v(0,0),this.unknown_dictionary=q??new x}loadTrie(K,U){return this.trie=j.load(K,U),this}loadTokenInfoDictionaries(K,U,X){return this.token_info_dictionary.loadDictionary(K),this.token_info_dictionary.loadPosVector(U),this.token_info_dictionary.loadTargetMap(X),this}loadConnectionCosts(K){return this.connection_costs.loadConnectionCosts(K),this}loadUnknownDictionaries(K,U,X,q,H,J){return this.unknown_dictionary.loadUnknownDictionaries(K,U,X,q,H,J),this}}var m=KK;class UK{#K;#U;constructor(K="dict/"){this.#K=new m,this.#U=K}#X=(K)=>new Promise((U,X)=>{if(!OK(K))return X(new Error(`${K} does not exist`));let q=MK(K);VK.gunzip(new Uint8Array(q),(H,J)=>{if(H)return X(H);let Q=new Uint8Array(J);U(Q.buffer)})});load=()=>new Promise((K,U)=>{Promise.all(["base.dat.gz","check.dat.gz","tid.dat.gz","tid_pos.dat.gz","tid_map.dat.gz","cc.dat.gz","unk.dat.gz","unk_pos.dat.gz","unk_map.dat.gz","unk_char.dat.gz","unk_compat.dat.gz","unk_invoke.dat.gz"].map((X)=>this.#X(LK.join(this.#U,X)))).then((X)=>{this.#K.loadTrie(new Int32Array(X[0]),new Int32Array(X[1])),this.#K.loadTokenInfoDictionaries(new Uint8Array(X[2]),new Uint8Array(X[3]),new Uint8Array(X[4])),this.#K.loadConnectionCosts(new Int16Array(X[5])),this.#K.loadUnknownDictionaries(new Uint8Array(X[6]),new Uint8Array(X[7]),new Uint8Array(X[8]),new Uint8Array(X[9]),new Uint32Array(X[10]),new Uint8Array(X[11])),K(this.#K)}).catch((X)=>{U(X)})})}var XK=UK;class qK{#K;constructor(K={}){this.#K=new XK(K.dicPath)}async build(){let K=await this.#K.load();return new t(K)}}var HK=qK;var RK=/^(\w+)\s+(\d)\s+(\d)\s+(\d)/,jK=/^(0x[0-9A-F]{4})(?:\s+([^#\s]+))(?:\s+([^#\s]+))*/,IK=/^(0x[0-9A-F]{4})\.\.(0x[0-9A-F]{4})(?:\s+([^#\s]+))(?:\s+([^#\s]+))*/;class JK{char_def;character_category_definition;category_mapping;constructor(){this.char_def=new M,this.char_def.invoke_definition_map=new w,this.character_category_definition=[],this.category_mapping=[]}putLine(K){let U=RK.exec(K);if(U!=null){let H=this.character_category_definition.length,J=M.parseCharCategory(H,U);if(J==null)return;this.character_category_definition.push(J);return}let X=jK.exec(K);if(X!=null){let H=M.parseCategoryMapping(X);this.category_mapping.push(H)}let q=IK.exec(K);if(q!=null){let H=M.parseRangeCategoryMapping(q);this.category_mapping.push(H)}}build(){if(!this.char_def||!this.char_def.invoke_definition_map)throw new Error("No data to build.");return this.char_def.invoke_definition_map.init(this.character_category_definition),this.char_def.initCategoryMappings(this.category_mapping),this.char_def}}var QK=JK;class ZK{lines;connection_cost;constructor(){this.lines=0,this.connection_cost=null}putLine(K){if(this.lines===0||!this.connection_cost){let J=K.split(" "),Q=Number.parseInt(J[0]),Z=Number.parseInt(J[1]);if(Q<0||Z<0)throw"Parse error of matrix.def";return this.connection_cost=new v(Q,Z),this.lines++,this}if(!this.connection_cost)throw"connection_cost is null";let U=K.split(" ");if(U.length!==3)return this;let X=Number.parseInt(U[0]),q=Number.parseInt(U[1]),H=Number.parseInt(U[2]);if(X<0||q<0||!Number.isFinite(X)||!Number.isFinite(q)||this.connection_cost.forward_dimension<=X||this.connection_cost.backward_dimension<=q)throw"Parse error of matrix.def";return this.connection_cost.put(X,q,H),this.lines++,this}build(){if(!this.connection_cost)throw"No data to build.";return this.connection_cost}}var $K=ZK;class PK{#K;#U;#X;#q;constructor(){this.#K=[],this.#U=[],this.#X=new $K,this.#q=new QK}addTokenInfoDictionary(K){let U=K.split(",");return this.#K.push(U),this}putCostMatrixLine(K){return this.#X.putLine(K),this}putCharDefLine(K){return this.#q.putLine(K),this}putUnkDefLine(K){return this.#U.push(K.split(",")),this}build(){let K=this.buildTokenInfoDictionary();return new m(K.trie,K.token_info_dictionary,this.#X.build(),this.buildUnknownDictionary())}buildTokenInfoDictionary(){let K=new V,U=K.buildDictionary(this.#K),X=this.buildDoubleArray();for(let q in U){let H=U[q],J=X.lookup(H);K.addMapping(J,Number.parseInt(q))}return{trie:X,token_info_dictionary:K}}buildUnknownDictionary(){let K=new x,U=K.buildDictionary(this.#U),X=this.#q.build();if(!X||!X.invoke_definition_map)throw new Error("CharacterDefinition is not set");K.characterDefinition(X);for(let q in U){let H=U[q],J=X.invoke_definition_map.lookup(H);if(!J)throw new Error(`Class name not found: ${H}`);K.addMapping(J,Number.parseInt(q))}return K}buildDoubleArray(){let K=0,U=this.#K.map((q)=>{return{k:q[0],v:K++}});return j.builder(1048576).build(U)}}var WK=PK;var A0={builder:(K={})=>{return new HK(K)},dictionaryBuilder:()=>{return new WK}};export{A0 as default,HK as TokenizerBuilder,WK as DictionaryBuilder};

//# debugId=013990B94F8AE29A64756E2164756E21
//# sourceMappingURL=index.min.js.map
