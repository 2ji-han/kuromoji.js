// @bun
class p{formatEntry(K,q,H,J){return{word_id:K,word_type:H,word_position:q,surface_form:J[0],pos:J[1],pos_detail_1:J[2],pos_detail_2:J[3],pos_detail_3:J[4],conjugated_type:J[5],conjugated_form:J[6],basic_form:J[7],reading:J[8],pronunciation:J[9]}}formatUnknownEntry(K,q,H,J,Q){return{word_id:K,word_type:H,word_position:q,surface_form:Q,pos:J[1],pos_detail_1:J[2],pos_detail_2:J[3],pos_detail_3:J[4],conjugated_type:J[5],conjugated_form:J[6],basic_form:J[7]}}}var b=p;class L{str;#K;length;constructor(K){this.str=K,this.#K=[];let q=K.length;for(let H=0;H<q;H++){let J=K.charAt(H);if(this.#K.push(H),L.isSurrogatePair(J))H++}this.length=this.#K.length}slice(K){if(this.#K.length<=K)return"";let q=this.#K[K];return this.str.slice(q)}charAt(K){if(this.str.length<=K)return"";let q=this.#K[K],H=this.#K[K+1];if(H==null)return this.str.slice(q);return this.str.slice(q,H)}charCodeAt(K){if(this.#K.length<=K)return Number.NaN;let q=this.#K[K],H=this.str.charCodeAt(q),J;if(H>=55296&&H<=56319&&q<this.str.length){if(J=this.str.charCodeAt(q+1),J>=56320&&J<=57343)return(H-55296)*1024+J-56320+65536}return H}toString(){return this.str}add(K){return new L(this.str+K.str)}append(K){return new L(this.str+K)}static isSurrogatePair(K){let q=K.charCodeAt(0);if(q>=55296&&q<=56319)return!0;return!1}}var z=L;class l{name;cost;start_pos;length;left_id;right_id;prev;surface_form;shortest_cost;type;constructor(K,q,H,J,Q,X,Z,$){this.name=K,this.cost=q,this.start_pos=H,this.length=J,this.left_id=X,this.right_id=Z,this.prev=null,this.surface_form=$,this.shortest_cost=Q==="BOS"?0:Number.MAX_VALUE,this.type=Q}}var V=l;class u{nodes_end_at;eos_pos;constructor(){this.nodes_end_at=[],this.nodes_end_at[0]=[new V(-1,0,0,0,"BOS",0,0,"")],this.eos_pos=1}append(K){let q=K.start_pos+K.length-1;if(this.eos_pos<q)this.eos_pos=q;let H=this.nodes_end_at[q]??[];H.push(K),this.nodes_end_at[q]=H}appendEos(){let K=this.nodes_end_at.length;this.eos_pos++,this.nodes_end_at[K]=[new V(-1,0,this.eos_pos,0,"EOS",0,0,"")]}}var f=u;class s{#K;#q;#H;constructor(K){this.#K=K.trie,this.#q=K.token_info_dictionary,this.#H=K.unknown_dictionary}build(K){let q=new f,H=new z(K),J=H.length;for(let Q=0;Q<J;Q++){let X=H.slice(Q),Z=this.#K.commonPrefixSearch(X),$=Z.length;for(let P=0;P<$;P++){let F=Z[P].v,Y=Z[P].k,I=this.#q.target_map.get(F);if(!I)throw new Error("TokenInfo dictionary is broken");for(let G of I){let M=this.#q.dictionary.getShort(G),N=this.#q.dictionary.getShort(G+2),T=this.#q.dictionary.getShort(G+4);q.append(new V(G,T,Q+1,Y.length,"KNOWN",M,N,Y))}}let U=X.charAt(0),W=this.#H.lookup(U);if(!Z?.length||W.is_always_invoke){let P=U,F=X.length;if(W.is_grouping&&F>1){let M=W.class_name;for(let N=1;N<F;N++){let T=X.charAt(N);if(this.#H.lookup(T).class_name!==M)break;P+=T}}let Y=this.#H.target_map.get(W.class_id);if(!Y)throw new Error("Unknown dictionary is broken");let I=Y.length,G=this.#H.dictionary;for(let M=0;M<I;M++){let N=Y[M];q.append(new V(N,G.getShort(N+4),Q+1,P.length,"UNKNOWN",G.getShort(N),G.getShort(N+2),P))}}}return q.appendEos(),q}}var c=s;class d{#K;constructor(K){this.#K=K}search(K){let q=K;return q=this.#q(q),this.#H(q)}#q(K){let q=1;for(q=1;q<=K.eos_pos;q++){let H=K.nodes_end_at[q];if(H==null)continue;for(let J of H){let Q=Number.MAX_VALUE,X=null,Z=J.start_pos-1;if(!(Z in K.nodes_end_at))continue;let $=K.nodes_end_at[Z];for(let U of $){let W;if(J.left_id==null||U.right_id==null)console.log("Left or right is null"),W=0;else W=this.#K.get(U.right_id,J.left_id);let P=U.shortest_cost+W+J.cost;if(P<Q)X=U,Q=P}J.prev=X,J.shortest_cost=Q}}return K}#H(K){let q=[],J=K.nodes_end_at[K.nodes_end_at.length-1][0].prev;if(J==null)return[];while(J.type!=="BOS"){if(q.push(J),J.prev==null)return[];J=J.prev}return q.reverse()}}var o=d;class m{#K;#q;#H;#J;#Q;constructor(K){this.#K=K.token_info_dictionary,this.#q=K.unknown_dictionary,this.#H=new c(K),this.#J=new o(K.connection_costs),this.#Q=new b}static splitByPunctuation(K){let q=K.matchAll(/\u3001|\u3002/g),H=[],J=0;for(let Q of q){let X=Q.index;H.push(K.slice(J,X+1)),J=X+1}if(J<K.length)H.push(K.slice(J));return H}tokenize(K){let q=m.splitByPunctuation(K),H=[];for(let J of q)this.#X(J,H);return H}#X(K,q=[]){let H=this.#H.build(K),J=this.#J.search(H),Q=q.length>0?q[q.length-1].word_position:0;for(let X of J)q.push(this.#Z(X,Q));return q}#Z(K,q){let H=K.type==="KNOWN"?this.#K.getFeatures(K.name):this.#q.getFeatures(K.name),J=H?H.split(","):[];if(K.type==="UNKNOWN")return this.#Q.formatUnknownEntry(K.name,q+K.start_pos,K.type,J,K.surface_form);return this.#Q.formatEntry(K.name,q+K.start_pos,K.type,J)}}var _=m;import{existsSync as MK,readFileSync as OK}from"fs";import VK from"path";import jK from"zlib";var A=new TextEncoder,FK=new TextDecoder,S=(K,q,H)=>{if(K)switch(q){case 1:return new Int8Array(H);case 2:return new Int16Array(H);case 4:return new Int32Array(H);default:throw new RangeError(`Invalid newArray parameter element_bytes:${q}`)}switch(q){case 1:return new Uint8Array(H);case 2:return new Uint16Array(H);case 4:return new Uint32Array(H);default:throw new RangeError(`Invalid newArray parameter element_bytes:${q}`)}},YK=(K,q,H)=>{return K.slice(q,q+H)};class h{#K;#q;#H;constructor(K=1024){this.#K=1,this.#q={signed:!0,bytes:4,array:S(!0,4,K)},this.#H={signed:!0,bytes:4,array:S(!0,4,K)},this.#q.array[0]=1,this.#H.array[0]=0,this.initBase(this.#q.array,1,this.#q.array.length),this.initCheck(this.#H.array,1,this.#H.array.length)}initBase(K,q,H){for(let J=q;J<H;J++)K[J]=-J+1;if(0<this.#H.array[this.#H.array.length-1]){let J=this.#H.array.length-2;while(0<this.#H.array[J])J--;K[q]=-J}}initCheck(K,q,H){for(let J=q;J<H;J++)K[J]=-J-1}realloc(K){let q=K*2,H=S(this.#q.signed,this.#q.bytes,q);this.initBase(H,this.#q.array.length,q),H.set(this.#q.array),this.#q.array=H;let J=S(this.#H.signed,this.#H.bytes,q);this.initCheck(J,this.#H.array.length,q),J.set(this.#H.array),this.#H.array=J}getBaseBuffer(){return this.#q.array}getCheckBuffer(){return this.#H.array}loadBaseBuffer(K){return this.#q.array=K,this}loadCheckBuffer(K){return this.#H.array=K,this}size(){return Math.max(this.#q.array.length,this.#H.array.length)}getBase(K){if(this.#q.array.length-1<K)return-K+1;return this.#q.array[K]}getCheck(K){if(this.#H.array.length-1<K)return-K-1;return this.#H.array[K]}setBase(K,q){if(this.#q.array.length-1<K)this.realloc(K);this.#q.array[K]=q}setCheck(K,q){if(this.#H.array.length-1<K)this.realloc(K);this.#H.array[K]=q}setFirstUnusedNode(K){this.#K=K}getFirstUnusedNode(){return this.#K}shrink(){let K=Math.max(this.#q.array.length,this.#H.array.length)-1;while(0<=this.#H.array[K])K--;this.#q.array=this.#q.array.subarray(0,K+2),this.#H.array=this.#H.array.subarray(0,K+2)}calc(){let K=0,q=this.#H.array.length;for(let H=0;H<q;H++)if(this.#H.array[H]<0)K++;return{all:q,unused:K,efficiency:(q-K)/q}}dump(){let K="",q="";for(let H of this.#q.array)K+=` ${H}`;for(let H of this.#H.array)q+=` ${H}`;return console.log(`base:${K}`),console.log(`check:${q}`),`base:${K} check:${q}`}}class t{#K;#q;constructor(K=1024){this.#K=new h(K),this.#q=[]}append(K,q){return this.#q.push({k:K,v:q}),this}build(K=this.#q,q=!1){if(K==null)return new B(this.#K);let H=K.map((J)=>{return{k:A.encode(J.k+"\x00"),v:J.v}});if(q)this.#q=H;else this.#q=H.sort((J,Q)=>{let X=J.k,Z=Q.k,$=Math.min(X.length,Z.length);for(let U=0;U<$;U++){if(X[U]===Z[U])continue;return X[U]-Z[U]}return X.length-Z.length});return this.#H(0,0,0,this.#q.length),new B(this.#K)}#H(K,q,H,J){let Q=this.getChildrenInfo(q,H,J),X=this.findAllocatableBase(Q);this.setBufferController(K,Q,X);for(let Z=0;Z<Q.length;Z=Z+3){let $=Q[Z];if($===0)continue;let U=Q[Z+1],W=Q[Z+2],P=X+$;this.#H(P,q+1,U,W)}}getChildrenInfo(K,q,H){let J=this.#q[q].k[K],Q=new Int32Array(H*3),X=0;Q[X++]=Number.parseInt(`${J}`),Q[X++]=q;let Z=q,$=q;for(;Z<q+H;Z++){let U=this.#q[Z].k[K];if(J!==U)Q[X++]=Z-$,Q[X++]=Number.parseInt(`${U}`),Q[X++]=Z,J=U,$=Z}return Q[X++]=Z-$,Q=Q.subarray(0,X),Q}setBufferController(K,q,H){let J=this.#K;J.setBase(K,H);for(let Q=0;Q<q.length;Q=Q+3){let X=q[Q],Z=H+X,$=-J.getBase(Z),U=-J.getCheck(Z);if(Z!==J.getFirstUnusedNode())J.setCheck($,-U);else J.setFirstUnusedNode(U);J.setBase(U,-$);let W=K;if(J.setCheck(Z,W),X===0){let P=q[Q+1],F=this.#q[P].v;if(F==null)F=0;let Y=-F-1;J.setBase(Z,Y)}}}findAllocatableBase(K){let q=this.#K,H,J=q.getFirstUnusedNode();while(!0){if(H=J-K[0],H<0){J=-q.getCheck(J);continue}let Q=!0;for(let X=0;X<K.length;X=X+3){let Z=K[X],$=H+Z;if(!this.isUnusedNode($)){J=-q.getCheck(J),Q=!1;break}}if(Q)return H}}isUnusedNode(K){let H=this.#K.getCheck(K);if(K===0)return!1;if(H<0)return!0;return!1}}class B{#K;constructor(K){this.#K=K,this.#K.shrink()}contain(K){let q=K,H=this.#K;q+="\x00";let J=A.encode(q),Q=0,X=-1;for(let Z=0;Z<J.length;Z++){let $=J[Z];if(X=this.traverse(Q,$),X===-1)return!1;if(H.getBase(X)<=0)return!0;Q=X}return!1}lookup(K){let q=K;q+="\x00";let H=A.encode(q),J=0,Q=-1;for(let Z=0;Z<H.length;Z++){let $=H[Z];if(Q=this.traverse(J,$),Q===-1)return-1;J=Q}let X=this.#K.getBase(Q);if(X<=0)return-X-1;return-1}commonPrefixSearch(K){let q=A.encode(K),H=[],J=0,Q=-1;for(let X=0;X<q.length;X++){let Z=q[X];if(Q=this.traverse(J,Z),Q!==-1){J=Q;let $=this.traverse(Q,0);if($!==-1){let U=this.#K.getBase($),W={k:"",v:0};if(U<=0)W.v=-U-1;W.k=FK.decode(YK(q,0,X+1)),H.push(W)}continue}break}return H}traverse(K,q){let H=this.#K.getBase(K)+q;if(this.#K.getCheck(H)===K)return H;return-1}size(){return this.#K.size()}calc(){return this.#K.calc()}dump(){return this.#K.dump()}}var NK={builder:(K=1024)=>{return new t(K)},load:(K,q)=>{let H=new h(0);return H.loadBaseBuffer(K),H.loadCheckBuffer(q),new B(H)}};var R=NK;class n{forward_dimension;backward_dimension;#K;constructor(K,q){this.forward_dimension=K,this.backward_dimension=q,this.#K=new Int16Array(K*q+2),this.#K[0]=K,this.#K[1]=q}put(K,q,H){let J=K*this.backward_dimension+q+2;if(this.#K.length<J+1)throw"ConnectionCosts buffer overflow";this.#K[J]=H}get(K,q){let H=K*this.backward_dimension+q+2;if(this.#K.length<H+1)throw"ConnectionCosts buffer overflow";return this.#K[H]}loadConnectionCosts(K){this.forward_dimension=K[0],this.backward_dimension=K[1],this.#K=K}}var D=n;var EK=new TextEncoder,GK=new TextDecoder;class a{buffer;position=0;constructor(K){if(K===void 0)this.buffer=new Uint8Array(1048576),this.position=0;else if(typeof K==="number"){let q=K;this.buffer=new Uint8Array(q),this.position=0}else if(K instanceof Uint8Array)this.buffer=K,this.position=0;else throw`${typeof K} is invalid parameter type for ByteBuffer constructor`}size(){return this.buffer.length}reallocate(){let K=new Uint8Array(this.buffer.length*2);K.set(this.buffer),this.buffer=K}shrink(){return this.buffer=this.buffer.subarray(0,this.position),this.buffer}put(K){if(this.buffer.length<this.position+1)this.reallocate();if(typeof K==="boolean")this.buffer[this.position++]=K?1:0;else this.buffer[this.position++]=K}get(K=null){let q=K;if(q==null)q=this.position,this.position+=1;if(this.buffer.length<q+1)return 0;return this.buffer[q]}putShort(K){if(65535<K)throw`${K} is over short value`;let q=255&K,H=(65280&K)>>8;this.put(q),this.put(H)}getShort(K){let q=K;if(q==null)q=this.position,this.position+=2;if(this.buffer.length<q+2)return 0;let H=this.buffer[q],Q=(this.buffer[q+1]<<8)+H;if(Q&32768)Q=-(Q-1^65535);return Q}putInt(K){if(4294967295<K)throw`${K} is over integer value`;let q=255&K,H=(65280&K)>>8,J=(16711680&K)>>16,Q=(4278190080&K)>>24;this.put(q),this.put(H),this.put(J),this.put(Q)}getInt(K=null){let q=K;if(q==null)q=this.position,this.position+=4;if(this.buffer.length<q+4)return 0;let H=this.buffer[q],J=this.buffer[q+1],Q=this.buffer[q+2];return(this.buffer[q+3]<<24)+(Q<<16)+(J<<8)+H}readInt(){let K=this.position;return this.position+=4,this.getInt(K)}putString(K){let q=EK.encode(K);if(!q)throw new Error("bytes null.");for(let H of q)this.put(H);this.put(0)}getString(K=this.position){let q=K,H=[],J;while(q<this.buffer.length){if(J=this.get(q++),J===0)break;H.push(J)}return this.position=q,GK.decode(new Uint8Array(H))}getUtf32(K=null){let q=K;if(q==null)q=this.position,this.position+=4;if(this.buffer.length<q+4)return 0;let H=this.buffer.subarray(q,q+4);return new DataView(H.buffer).getUint32(0,!1)}getBool(K=null){let q=K;if(q==null)q=this.position,this.position+=1;if(this.buffer.length<q+1)return!1;return Boolean(this.buffer[q])}}var E=a;class i{dictionary;target_map;pos_buffer;constructor(){this.dictionary=new E(10485760),this.target_map=new Map,this.pos_buffer=new E(10485760)}buildDictionary(K){let q={};for(let H=0;H<K.length;H++){let J=K[H];if(J.length<4)continue;let Q=J[0],X=Number.parseInt(J[1]),Z=Number.parseInt(J[2]),$=Number.parseInt(J[3]),U=J.slice(4).join(",");if(!Number.isFinite(X)||!Number.isFinite(Z)||!Number.isFinite($))console.log(J);let W=this.put(X,Z,$,Q,U);q[W]=Q}return this.dictionary.shrink(),this.pos_buffer.shrink(),q}put(K,q,H,J,Q){let X=this.dictionary.position,Z=this.pos_buffer.position;return this.dictionary.putShort(K),this.dictionary.putShort(q),this.dictionary.putShort(H),this.dictionary.putInt(Z),this.pos_buffer.putString(`${J},${Q}`),X}addMapping(K,q){let H=this.target_map.get(K);if(H==null)H=[];H.push(q),this.target_map.set(K,H)}targetMapToBuffer(){let K=new E;K.putInt(Object.keys(this.target_map).length);for(let q in this.target_map){let H=Number.parseInt(q),J=this.target_map.get(H);if(!J)continue;let Q=J.length;K.putInt(H),K.putInt(Q);for(let X of J)K.putInt(X)}return K.shrink()}loadDictionary(K){return this.dictionary=new E(K),this}loadPosVector(K){return this.pos_buffer=new E(K),this}loadTargetMap(K){let q=new E(K);q.position=0,this.target_map=new Map,q.readInt();while(!0){if(q.buffer.length<q.position+1)break;let H=q.readInt(),J=q.readInt();for(let Q=0;Q<J;Q++){let X=q.readInt();this.addMapping(H,X)}}return this}getFeatures(K){if(Number.isNaN(K))return null;let q=this.dictionary.getInt(K+6);return this.pos_buffer.getString(q)}}var j=i;class r{class_id;class_name;is_always_invoke;is_grouping;max_length;constructor(K,q,H,J,Q){this.class_id=K,this.class_name=q,this.is_always_invoke=H,this.is_grouping=J,this.max_length=Q}}var v=r;class k{#K;#q;constructor(){this.#K=[],this.#q=new Map}static load(K){let q=new k,H=[],J=new E(K);while(J.position+1<J.size()){let Q=J.getBool(),X=J.getBool(),Z=J.getInt(),$=J.getString();H.push(new v(H.length,$,Q,X,Z))}return q.init(H),q}init(K){if(K==null)return;let q=K.length;for(let H=0;H<q;H++){let J=K[H];this.#K[H]=J,this.#q.set(J.class_name,H)}}getCharacterClass(K){return this.#K[K]}lookup(K){let q=this.#q.get(K);if(q==null)return null;return q}toBuffer(){let K=new E;for(let q=0;q<this.#K.length;q++){let H=this.#K[q];K.put(H.is_always_invoke),K.put(H.is_grouping),K.putInt(H.max_length),K.putString(H.class_name)}return K.shrink(),K.buffer}}var C=k;var y="DEFAULT";class g{character_category_map;compatible_category_map;invoke_definition_map;constructor(){this.character_category_map=new Uint8Array(65536),this.compatible_category_map=new Uint32Array(65536),this.invoke_definition_map=null}load(K,q,H){let J=new g;return J.character_category_map=K,J.compatible_category_map=q,J.invoke_definition_map=C.load(H),J}static parseCharCategory(K,q){let H=q[1],J=Number.parseInt(q[2]),Q=Number.parseInt(q[3]),X=Number.parseInt(q[4]);if(!Number.isFinite(J)||J!==0&&J!==1)return console.log(`char.def parse error. INVOKE is 0 or 1 in:${J}`),null;if(!Number.isFinite(Q)||Q!==0&&Q!==1)return console.log(`char.def parse error. GROUP is 0 or 1 in:${Q}`),null;if(!Number.isFinite(X)||X<0)return console.log(`char.def parse error. LENGTH is 1 to n:${X}`),null;return new v(K,H,J===1,Q===1,X)}static parseCategoryMapping(K){let q=Number.parseInt(K[1]);if(!Number.isFinite(q)||q<0||q>65535)console.log(`char.def parse error. CODE is invalid:${q}`);return{start:q,default:K[2],compatible:3<K.length?K.slice(3):[]}}static parseRangeCategoryMapping(K){let q=Number.parseInt(K[1]),H=Number.parseInt(K[2]);if(!Number.isFinite(q)||q<0||q>65535)console.log(`char.def parse error. CODE is invalid:${q}`);if(!Number.isFinite(H)||H<0||H>65535)console.log(`char.def parse error. CODE is invalid:${H}`);return{start:q,end:H,default:K[3],compatible:4<K.length?K.slice(4):[]}}initCategoryMappings(K){if(!this.invoke_definition_map)throw new Error("CharacterDefinition.initCategoryMappings: invoke_definition_map is null");let q=0;if(K!=null){let Q=K.length;for(let X=0;X<Q;X++){let Z=K[X];for(q=Z.start;q<=(Z.end||Z.start);q++){let $=this.invoke_definition_map.lookup(Z.default);if($==null)throw new Error("CharacterDefinition.initCategoryMappings: invoke_definition_map.lookup() returns null");this.character_category_map[q]=$;for(let U=0;U<Z.compatible.length;U++){let W=this.compatible_category_map[q],P=Z.compatible[U];if(P==null)continue;let F=this.invoke_definition_map.lookup(P);if(F==null)continue;let Y=1<<F;W=W|Y,this.compatible_category_map[q]=W}}}}let H=this.invoke_definition_map.lookup(y);if(H==null)return;let J=this.compatible_category_map.length;for(q=0;q<J;q++)if(this.character_category_map[q]===0)this.character_category_map[q]=1<<H}lookupCompatibleCategory(K){let q=[];if(!this.invoke_definition_map)throw new Error("CharacterDefinition.lookupCompatibleCategory: invoke_definition_map is null");let H=K.charCodeAt(0),J=null;if(H<this.compatible_category_map.length)J=this.compatible_category_map[H];if(J==null||J===0)return q;for(let Q=0;Q<32;Q++)if(J<<31-Q>>>31===1){let X=this.invoke_definition_map.getCharacterClass(Q);if(X==null)continue;q.push(X)}return q}lookup(K){if(!this.invoke_definition_map)throw new Error("CharacterDefinition.lookup: invoke_definition_map is null");let q=null,H=K.charCodeAt(0);if(z.isSurrogatePair(K))q=this.invoke_definition_map.lookup(y);else if(H<this.character_category_map.length)q=this.character_category_map[H];if(q==null)q=this.invoke_definition_map.lookup(y);return this.invoke_definition_map.getCharacterClass(q)}}var O=g;class e extends j{#K=null;characterDefinition(K){return this.#K=K,this}lookup(K){if(this.#K==null)throw new Error("CharacterDefinition is not set");return this.#K.lookup(K)}lookupCompatibleCategory(K){if(this.#K==null)throw new Error("CharacterDefinition is not set");return this.#K.lookupCompatibleCategory(K)}loadUnknownDictionaries(K,q,H,J,Q,X){this.loadDictionary(K),this.loadPosVector(q),this.loadTargetMap(H),this.#K=new O().load(J,Q,X)}}var w=e;class KK{trie;token_info_dictionary;connection_costs;unknown_dictionary;constructor(K,q,H,J){this.trie=K??R.builder(0).build([{k:"",v:1}]),this.token_info_dictionary=q??new j,this.connection_costs=H??new D(0,0),this.unknown_dictionary=J??new w}loadTrie(K,q){return this.trie=R.load(K,q),this}loadTokenInfoDictionaries(K,q,H){return this.token_info_dictionary.loadDictionary(K),this.token_info_dictionary.loadPosVector(q),this.token_info_dictionary.loadTargetMap(H),this}loadConnectionCosts(K){return this.connection_costs.loadConnectionCosts(K),this}loadUnknownDictionaries(K,q,H,J,Q,X){return this.unknown_dictionary.loadUnknownDictionaries(K,q,H,J,Q,X),this}}var x=KK;class qK{#K;#q;constructor(K="dict/"){this.#K=new x,this.#q=K}#H=(K)=>new Promise((q,H)=>{if(!MK(K))return H(new Error(`${K} does not exist`));let J=OK(K);jK.gunzip(new Uint8Array(J),(Q,X)=>{if(Q)return H(Q);let Z=new Uint8Array(X);q(Z.buffer)})});load(K){Promise.all(["base.dat.gz","check.dat.gz","tid.dat.gz","tid_pos.dat.gz","tid_map.dat.gz","cc.dat.gz","unk.dat.gz","unk_pos.dat.gz","unk_map.dat.gz","unk_char.dat.gz","unk_compat.dat.gz","unk_invoke.dat.gz"].map((q)=>this.#H(VK.join(this.#q,q)))).then((q)=>{this.#K.loadTrie(new Int32Array(q[0]),new Int32Array(q[1])),this.#K.loadTokenInfoDictionaries(new Uint8Array(q[2]),new Uint8Array(q[3]),new Uint8Array(q[4])),this.#K.loadConnectionCosts(new Int16Array(q[5])),this.#K.loadUnknownDictionaries(new Uint8Array(q[6]),new Uint8Array(q[7]),new Uint8Array(q[8]),new Uint8Array(q[9]),new Uint32Array(q[10]),new Uint8Array(q[11])),K(null,this.#K)}).catch((q)=>{K(q,this.#K)})}}var HK=qK;class JK{#K;constructor(K={}){this.#K=new HK(K.dicPath)}build(K){this.#K.load((q,H)=>{K(q,new _(H))})}}var QK=JK;var LK=/^(\w+)\s+(\d)\s+(\d)\s+(\d)/,RK=/^(0x[0-9A-F]{4})(?:\s+([^#\s]+))(?:\s+([^#\s]+))*/,IK=/^(0x[0-9A-F]{4})\.\.(0x[0-9A-F]{4})(?:\s+([^#\s]+))(?:\s+([^#\s]+))*/;class XK{char_def;character_category_definition;category_mapping;constructor(){this.char_def=new O,this.char_def.invoke_definition_map=new C,this.character_category_definition=[],this.category_mapping=[]}putLine(K){let q=LK.exec(K);if(q!=null){let Q=this.character_category_definition.length,X=O.parseCharCategory(Q,q);if(X==null)return;this.character_category_definition.push(X);return}let H=RK.exec(K);if(H!=null){let Q=O.parseCategoryMapping(H);this.category_mapping.push(Q)}let J=IK.exec(K);if(J!=null){let Q=O.parseRangeCategoryMapping(J);this.category_mapping.push(Q)}}build(){if(!this.char_def||!this.char_def.invoke_definition_map)throw new Error("No data to build.");return this.char_def.invoke_definition_map.init(this.character_category_definition),this.char_def.initCategoryMappings(this.category_mapping),this.char_def}}var ZK=XK;class $K{lines;connection_cost;constructor(){this.lines=0,this.connection_cost=null}putLine(K){if(this.lines===0||!this.connection_cost){let X=K.split(" "),Z=Number.parseInt(X[0]),$=Number.parseInt(X[1]);if(Z<0||$<0)throw"Parse error of matrix.def";return this.connection_cost=new D(Z,$),this.lines++,this}if(!this.connection_cost)throw"connection_cost is null";let q=K.split(" ");if(q.length!==3)return this;let H=Number.parseInt(q[0]),J=Number.parseInt(q[1]),Q=Number.parseInt(q[2]);if(H<0||J<0||!Number.isFinite(H)||!Number.isFinite(J)||this.connection_cost.forward_dimension<=H||this.connection_cost.backward_dimension<=J)throw"Parse error of matrix.def";return this.connection_cost.put(H,J,Q),this.lines++,this}build(){if(!this.connection_cost)throw"No data to build.";return this.connection_cost}}var UK=$K;class WK{#K;#q;#H;#J;constructor(){this.#K=[],this.#q=[],this.#H=new UK,this.#J=new ZK}addTokenInfoDictionary(K){let q=K.split(",");return this.#K.push(q),this}putCostMatrixLine(K){return this.#H.putLine(K),this}putCharDefLine(K){return this.#J.putLine(K),this}putUnkDefLine(K){return this.#q.push(K.split(",")),this}build(){let K=this.buildTokenInfoDictionary();return new x(K.trie,K.token_info_dictionary,this.#H.build(),this.buildUnknownDictionary())}buildTokenInfoDictionary(){let K=new j,q=K.buildDictionary(this.#K),H=this.buildDoubleArray();for(let J in q){let Q=q[J],X=H.lookup(Q);K.addMapping(X,Number.parseInt(J))}return{trie:H,token_info_dictionary:K}}buildUnknownDictionary(){let K=new w,q=K.buildDictionary(this.#q),H=this.#J.build();if(!H||!H.invoke_definition_map)throw new Error("CharacterDefinition is not set");K.characterDefinition(H);for(let J in q){let Q=q[J],X=H.invoke_definition_map.lookup(Q);if(!X)throw new Error(`Class name not found: ${Q}`);K.addMapping(X,Number.parseInt(J))}return K}buildDoubleArray(){let K=0,q=this.#K.map((J)=>{return{k:J[0],v:K++}});return R.builder(1048576).build(q)}}var PK=WK;var A8={builder:(K={})=>{return new QK(K)},dictionaryBuilder:()=>{return new PK}};export{A8 as default,QK as TokenizerBuilder,PK as DictionaryBuilder};

//# debugId=02945533225CD23664756E2164756E21
//# sourceMappingURL=index.min.js.map
