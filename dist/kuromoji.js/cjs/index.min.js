var S8=Object.create;var{getPrototypeOf:A8,defineProperty:R,getOwnPropertyNames:t,getOwnPropertyDescriptor:T8}=Object,_=Object.prototype.hasOwnProperty;var a=(K,$,q)=>{q=K!=null?S8(A8(K)):{};let J=$||!K||!K.__esModule?R(q,"default",{value:K,enumerable:!0}):q;for(let Q of t(K))if(!_.call(J,Q))R(J,Q,{get:()=>K[Q],enumerable:!0});return J},o=new WeakMap,B8=(K)=>{var $=o.get(K),q;if($)return $;if($=R({},"__esModule",{value:!0}),K&&typeof K==="object"||typeof K==="function")t(K).map((J)=>!_.call($,J)&&R($,J,{get:()=>K[J],enumerable:!(q=T8(K,J))||q.enumerable}));return o.set(K,$),$};var O8=(K,$)=>{for(var q in $)R(K,q,{get:$[q],enumerable:!0,configurable:!0,set:(J)=>$[q]=()=>J})};var y8={};O8(y8,{default:()=>h8,TokenizerBuilder:()=>d,DictionaryBuilder:()=>c});module.exports=B8(y8);var S=(K,$,q)=>{if(K)switch($){case 1:return new Int8Array(q);case 2:return new Int16Array(q);case 4:return new Int32Array(q);default:throw new RangeError(`Invalid parameter: ${$}`)}switch($){case 1:return new Uint8Array(q);case 2:return new Uint16Array(q);case 4:return new Uint32Array(q);default:throw new RangeError(`Invalid parameter: ${$}`)}};var g="\x00",p=0,G=0,j=-1,v=new TextEncoder,v8=new TextDecoder;class b{#K;#$;#q;constructor(K=1024){this.#K=G+1,this.#$={signed:!0,bytes:4,array:S(!0,4,K)},this.#q={signed:!0,bytes:4,array:S(!0,4,K)},this.#$.array[G]=1,this.#q.array[G]=G,this.#J(this.#$.array,G+1,this.#$.array.length),this.#Q(this.#q.array,G+1,this.#q.array.length)}#J(K,$,q){for(let J=$;J<q;J++)K[J]=-J+1;if(0<this.#q.array[this.#q.array.length-1]){let J=this.#q.array.length-2;while(0<this.#q.array[J])J--;K[$]=-J}}#Q(K,$,q){for(let J=$;J<q;J++)K[J]=-J-1}#X(K){let $=K*2,q=S(this.#$.signed,this.#$.bytes,$);this.#J(q,this.#$.array.length,$),q.set(this.#$.array),this.#$.array=q;let J=S(this.#q.signed,this.#q.bytes,$);this.#Q(J,this.#q.array.length,$),J.set(this.#q.array),this.#q.array=J}getBaseBuffer(){return this.#$.array}getCheckBuffer(){return this.#q.array}loadBaseBuffer(K){return this.#$.array=K,this}loadCheckBuffer(K){return this.#q.array=K,this}size(){return Math.max(this.#$.array.length,this.#q.array.length)}getBase(K){if(this.#$.array.length-1<K)return-K+1;return this.#$.array[K]}getCheck(K){if(this.#q.array.length-1<K)return-K-1;return this.#q.array[K]}setBase(K,$){if(this.#$.array.length-1<K)this.#X(K);this.#$.array[K]=$}setCheck(K,$){if(this.#q.array.length-1<K)this.#X(K);this.#q.array[K]=$}setFirstUnusedNode(K){this.#K=K}getFirstUnusedNode(){return this.#K}shrink(){let K=Math.max(this.#$.array.length,this.#q.array.length)-1;while(0<=this.#q.array[K])K--;this.#$.array=this.#$.array.subarray(0,K+2),this.#q.array=this.#q.array.subarray(0,K+2)}calc(){let K=0,$=this.#q.array.length;for(let q=0;q<$;q++)if(this.#q.array[q]<0)K++;return{all:$,unused:K,efficiency:($-K)/$}}dump(){let K="",$="";for(let q of this.#$.array)K+=` ${q}`;for(let q of this.#q.array)$+=` ${q}`;return console.log(`base:${K}`),console.log(`check:${$}`),`base:${K} check:${$}`}}class n{#K;#$;constructor(K=1024){this.#K=new b(K),this.#$=[]}append(K,$){return this.#$.push({k:K,v:$}),this}build(K=this.#$,$=!1){if(K==null)return new D(this.#K);let q=K.map((J)=>{return{k:v.encode(J.k+g),v:J.v}});if($)this.#$=q;else this.#$=q.sort((J,Q)=>{let X=J.k,Z=Q.k,H=Math.min(X.length,Z.length);for(let W=0;W<H;W++){if(X[W]===Z[W])continue;return X[W]-Z[W]}return X.length-Z.length});return this.#q(G,0,0,this.#$.length),new D(this.#K)}#q(K,$,q,J){let Q=this.#J($,q,J),X=this.#X(Q);this.#Q(K,Q,X);for(let Z=0;Z<Q.length;Z=Z+3){let H=Q[Z];if(H===p)continue;let W=Q[Z+1],P=Q[Z+2],Y=X+H;this.#q(Y,$+1,W,P)}}#J(K,$,q){let J=this.#$[$].k[K],Q=new Int32Array(q*3),X=0;Q[X++]=Number.parseInt(`${J}`),Q[X++]=$;let Z=$,H=$;for(;Z<$+q;Z++){let W=this.#$[Z].k[K];if(J!==W)Q[X++]=Z-H,Q[X++]=Number.parseInt(`${W}`),Q[X++]=Z,J=W,H=Z}return Q[X++]=Z-H,Q=Q.subarray(0,X),Q}#Q(K,$,q){let J=this.#K;J.setBase(K,q);for(let Q=0;Q<$.length;Q=Q+3){let X=$[Q],Z=q+X,H=-J.getBase(Z),W=-J.getCheck(Z);if(Z!==J.getFirstUnusedNode())J.setCheck(H,-W);else J.setFirstUnusedNode(W);J.setBase(W,-H);let P=K;if(J.setCheck(Z,P),X===p){let Y=$[Q+1],U=this.#$[Y].v;if(U==null)U=0;let L=-U-1;J.setBase(Z,L)}}}#X(K){let $=this.#K,q,J=$.getFirstUnusedNode();while(!0){if(q=J-K[0],q<0){J=-$.getCheck(J);continue}let Q=!0;for(let X=0;X<K.length;X=X+3){let Z=K[X],H=q+Z;if(!this.#Z(H)){J=-$.getCheck(J),Q=!1;break}}if(Q)return q}}#Z(K){let q=this.#K.getCheck(K);if(K===G)return!1;if(q<0)return!0;return!1}}class D{#K;constructor(K){this.#K=K,this.#K.shrink()}contain(K){let $=K,q=this.#K;$+=g;let J=v.encode($),Q=G,X=j;for(let Z=0;Z<J.length;Z++){let H=J[Z];if(X=this.#$(Q,H),X===j)return!1;if(q.getBase(X)<=0)return!0;Q=X}return!1}lookup(K){let $=K;$+=g;let q=v.encode($),J=G,Q=j;for(let Z=0;Z<q.length;Z++){let H=q[Z];if(Q=this.#$(J,H),Q===j)return j;J=Q}let X=this.#K.getBase(Q);if(X<=0)return-X-1;return j}commonPrefixSearch(K){let $=v.encode(K),q=[],J=G,Q=j;for(let X=0;X<$.length;X++){let Z=$[X];if(Q=this.#$(J,Z),Q!==j){J=Q;let H=this.#$(Q,p);if(H!==j){let W=this.#K.getBase(H),P={k:"",v:0};if(W<=0)P.v=-W-1;P.k=v8.decode($.slice(0,X+1)),q.push(P)}continue}break}return q}#$(K,$){let q=this.#K.getBase(K)+$;if(this.#K.getCheck(q)===K)return q;return j}size(){return this.#K.size()}calc(){return this.#K.calc()}dump(){return this.#K.dump()}}var A={builder:(K=1024)=>{return new n(K)},load:(K,$)=>{let q=new b(0);return q.loadBaseBuffer(K),q.loadCheckBuffer($),new D(q)}};class i{forward_dimension;backward_dimension;#K;constructor(K,$){this.forward_dimension=K,this.backward_dimension=$,this.#K=new Int16Array(K*$+2),this.#K[0]=K,this.#K[1]=$}put(K,$,q){let J=K*this.backward_dimension+$+2;if(this.#K.length<J+1)throw"ConnectionCosts buffer overflow";this.#K[J]=q}get(K,$){let q=K*this.backward_dimension+$+2;if(this.#K.length<q+1)throw"ConnectionCosts buffer overflow";return this.#K[q]}loadConnectionCosts(K){this.forward_dimension=K[0],this.backward_dimension=K[1],this.#K=K}}var w=i;var D8=new TextEncoder,w8=new TextDecoder;class r{#K;#$=0;get buffer(){return this.#K}set buffer(K){this.#K=K}get position(){return this.#$}set position(K){this.#$=K}constructor(K){if(K===void 0)this.#K=new Uint8Array(1048576),this.#$=0;else if(typeof K==="number")this.#K=new Uint8Array(K),this.#$=0;else if(K instanceof Uint8Array)this.#K=K,this.#$=0;else throw`${typeof K} is invalid parameter type`}size(){return this.#K.length}reallocate(){let K=new Uint8Array(this.#K.length*2);K.set(this.#K),this.#K=K}shrink(){return this.#K=this.#K.subarray(0,this.#$),this.#K}put(K){if(this.#K.length<this.#$+1)this.reallocate();if(typeof K==="boolean")this.#K[this.#$++]=K?1:0;else this.#K[this.#$++]=K}get(K=null){let $=K;if($==null)$=this.#$,this.#$+=1;if(this.#K.length<$+1)return 0;return this.#K[$]}putShort(K){if(65535<K)throw`${K} is over short value`;let $=255&K,q=(65280&K)>>8;this.put($),this.put(q)}getShort(K){let $=K;if($==null)$=this.#$,this.#$+=2;if(this.#K.length<$+2)return 0;let q=this.#K[$],Q=(this.#K[$+1]<<8)+q;if(Q&32768)Q=-(Q-1^65535);return Q}putInt(K){if(4294967295<K)throw`${K} is over integer value`;let $=255&K,q=(65280&K)>>8,J=(16711680&K)>>16,Q=(4278190080&K)>>24;this.put($),this.put(q),this.put(J),this.put(Q)}getInt(K=null){let $=K;if($==null)$=this.#$,this.#$+=4;if(this.#K.length<$+4)return 0;let q=this.#K[$],J=this.#K[$+1],Q=this.#K[$+2];return(this.#K[$+3]<<24)+(Q<<16)+(J<<8)+q}readInt(){let K=this.#$;return this.#$+=4,this.getInt(K)}putString(K){let $=D8.encode(K);for(let q of $)this.put(q);this.put(0)}getString(K=this.#$){let $=K,q=[],J;while($<this.#K.length){if(J=this.get($++),J===0)break;q.push(J)}return this.#$=$,w8.decode(new Uint8Array(q))}getUtf32(K=null){let $=K;if($==null)$=this.#$,this.#$+=4;if(this.#K.length<$+4)return 0;let q=this.#K.subarray($,$+4);return new DataView(q.buffer).getUint32(0,!1)}getBool(K=null){let $=K;if($==null)$=this.#$,this.#$+=1;if(this.#K.length<$+1)return!1;return Boolean(this.#K[$])}}var F=r;class e{dictionary;target_map;pos_buffer;constructor(){this.dictionary=new F(10485760),this.target_map=new Map,this.pos_buffer=new F(10485760)}buildDictionary(K){let $={};for(let q=0;q<K.length;q++){let J=K[q];if(J.length<4)continue;let Q=J[0],X=Number.parseInt(J[1]),Z=Number.parseInt(J[2]),H=Number.parseInt(J[3]),W=J.slice(4).join(",");if(!Number.isFinite(X)||!Number.isFinite(Z)||!Number.isFinite(H))console.log(J);let P=this.put(X,Z,H,Q,W);$[P]=Q}return this.dictionary.shrink(),this.pos_buffer.shrink(),$}put(K,$,q,J,Q){let X=this.dictionary.position,Z=this.pos_buffer.position;return this.dictionary.putShort(K),this.dictionary.putShort($),this.dictionary.putShort(q),this.dictionary.putInt(Z),this.pos_buffer.putString(`${J},${Q}`),X}addMapping(K,$){let q=this.target_map.get(K);if(q==null)q=[];q.push($),this.target_map.set(K,q)}targetMapToBuffer(){let K=new F;K.putInt(Object.keys(this.target_map).length);for(let $ in this.target_map){let q=Number.parseInt($),J=this.target_map.get(q);if(!J)continue;let Q=J.length;K.putInt(q),K.putInt(Q);for(let X of J)K.putInt(X)}return K.shrink()}loadDictionary(K){return this.dictionary=new F(K),this}loadPosVector(K){return this.pos_buffer=new F(K),this}loadTargetMap(K){let $=new F(K);$.position=0,this.target_map=new Map,$.readInt();while(!0){if($.buffer.length<$.position+1)break;let q=$.readInt(),J=$.readInt();for(let Q=0;Q<J;Q++){let X=$.readInt();this.addMapping(q,X)}}return this}getFeatures(K){if(Number.isNaN(K))return null;let $=this.dictionary.getInt(K+6);return this.pos_buffer.getString($)}}var z=e;class T{#K;#$;length;constructor(K){this.#K=K,this.#$=[];for(let $=0;$<K.length;$++){let q=K.charAt($);if(this.#$.push($),T.isSurrogatePair(q))$++}this.length=this.#$.length}slice(K){if(this.#$.length<=K)return"";let $=this.#$[K];return this.#K.slice($)}charAt(K){if(this.#K.length<=K)return"";let $=this.#$[K],q=this.#$[K+1];if(q==null)return this.#K.slice($);return this.#K.slice($,q)}charCodeAt(K){if(this.#$.length<=K)return Number.NaN;let $=this.#$[K],q=this.#K.charCodeAt($),J;if(q>=55296&&q<=56319&&$<this.#K.length){if(J=this.#K.charCodeAt($+1),J>=56320&&J<=57343)return(q-55296)*1024+J-56320+65536}return q}toString(){return this.#K}add(K){return new T(this.#K+K.#K)}append(K){return new T(this.#K+K)}static isSurrogatePair(K){let $=K.charCodeAt(0);if($>=55296&&$<=56319)return!0;return!1}}var C=T;class K8{class_id;class_name;is_always_invoke;is_grouping;max_length;constructor(K,$,q,J,Q){this.class_id=K,this.class_name=$,this.is_always_invoke=q,this.is_grouping=J,this.max_length=Q}}var x=K8;class l{#K;#$;constructor(){this.#K=[],this.#$=new Map}static load(K){let $=new l,q=[],J=new F(K);while(J.position+1<J.size()){let Q=J.getBool(),X=J.getBool(),Z=J.getInt(),H=J.getString();q.push(new x(q.length,H,Q,X,Z))}return $.init(q),$}init(K){if(K==null)return;let $=K.length;for(let q=0;q<$;q++){let J=K[q];this.#K[q]=J,this.#$.set(J.class_name,q)}}getCharacterClass(K){return this.#K[K]}lookup(K){let $=this.#$.get(K);if($==null)return null;return $}toBuffer(){let K=new F;for(let $=0;$<this.#K.length;$++){let q=this.#K[$];K.put(q.is_always_invoke),K.put(q.is_grouping),K.putInt(q.max_length),K.putString(q.class_name)}return K.shrink(),K.buffer}}var m=l;var u="DEFAULT";class f{character_category_map;compatible_category_map;invoke_definition_map;constructor(){this.character_category_map=new Uint8Array(65536),this.compatible_category_map=new Uint32Array(65536),this.invoke_definition_map=null}load(K,$,q){let J=new f;return J.character_category_map=K,J.compatible_category_map=$,J.invoke_definition_map=m.load(q),J}static parseCharCategory(K,$){let q=$[1],J=Number.parseInt($[2]),Q=Number.parseInt($[3]),X=Number.parseInt($[4]);if(!Number.isFinite(J)||J!==0&&J!==1)return console.log(`char.def parse error. INVOKE is 0 or 1 in:${J}`),null;if(!Number.isFinite(Q)||Q!==0&&Q!==1)return console.log(`char.def parse error. GROUP is 0 or 1 in:${Q}`),null;if(!Number.isFinite(X)||X<0)return console.log(`char.def parse error. LENGTH is 1 to n:${X}`),null;return new x(K,q,J===1,Q===1,X)}static parseCategoryMapping(K){let $=Number.parseInt(K[1]);if(!Number.isFinite($)||$<0||$>65535)console.log(`char.def parse error. CODE is invalid:${$}`);return{start:$,default:K[2],compatible:3<K.length?K.slice(3):[]}}static parseRangeCategoryMapping(K){let $=Number.parseInt(K[1]),q=Number.parseInt(K[2]);if(!Number.isFinite($)||$<0||$>65535)console.log(`char.def parse error. CODE is invalid:${$}`);if(!Number.isFinite(q)||q<0||q>65535)console.log(`char.def parse error. CODE is invalid:${q}`);return{start:$,end:q,default:K[3],compatible:4<K.length?K.slice(4):[]}}initCategoryMappings(K){if(!this.invoke_definition_map)throw new Error("CharacterDefinition.initCategoryMappings: invoke_definition_map is null");let $=0;if(K!=null){let Q=K.length;for(let X=0;X<Q;X++){let Z=K[X];for($=Z.start;$<=(Z.end||Z.start);$++){let H=this.invoke_definition_map.lookup(Z.default);if(H==null)throw new Error("CharacterDefinition.initCategoryMappings: invoke_definition_map.lookup() returns null");this.character_category_map[$]=H;for(let W=0;W<Z.compatible.length;W++){let P=this.compatible_category_map[$],Y=Z.compatible[W];if(Y==null)continue;let U=this.invoke_definition_map.lookup(Y);if(U==null)continue;let L=1<<U;P=P|L,this.compatible_category_map[$]=P}}}}let q=this.invoke_definition_map.lookup(u);if(q==null)return;let J=this.compatible_category_map.length;for($=0;$<J;$++)if(this.character_category_map[$]===0)this.character_category_map[$]=1<<q}lookupCompatibleCategory(K){let $=[];if(!this.invoke_definition_map)throw new Error("CharacterDefinition.lookupCompatibleCategory: invoke_definition_map is null");let q=K.charCodeAt(0),J=null;if(q<this.compatible_category_map.length)J=this.compatible_category_map[q];if(J==null||J===0)return $;for(let Q=0;Q<32;Q++)if(J<<31-Q>>>31===1){let X=this.invoke_definition_map.getCharacterClass(Q);if(X==null)continue;$.push(X)}return $}lookup(K){if(!this.invoke_definition_map)throw new Error("CharacterDefinition.lookup: invoke_definition_map is null");let $=null,q=K.charCodeAt(0);if(C.isSurrogatePair(K))$=this.invoke_definition_map.lookup(u);else if(q<this.character_category_map.length)$=this.character_category_map[q];if($==null)$=this.invoke_definition_map.lookup(u);return this.invoke_definition_map.getCharacterClass($)}}var I=f;class $8 extends z{#K=null;characterDefinition(K){return this.#K=K,this}lookup(K){if(this.#K==null)throw new Error("CharacterDefinition is not set");return this.#K.lookup(K)}lookupCompatibleCategory(K){if(this.#K==null)throw new Error("CharacterDefinition is not set");return this.#K.lookupCompatibleCategory(K)}loadUnknownDictionaries(K,$,q,J,Q,X){this.loadDictionary(K),this.loadPosVector($),this.loadTargetMap(q),this.#K=new I().load(J,Q,X)}}var h=$8;class q8{trie;token_info_dictionary;connection_costs;unknown_dictionary;constructor(K,$,q,J){this.trie=K??A.builder(0).build([{k:"",v:1}]),this.token_info_dictionary=$??new z,this.connection_costs=q??new w(0,0),this.unknown_dictionary=J??new h}loadTrie(K,$){return this.trie=A.load(K,$),this}loadTokenInfoDictionaries(K,$,q){return this.token_info_dictionary.loadDictionary(K),this.token_info_dictionary.loadPosVector($),this.token_info_dictionary.loadTargetMap(q),this}loadConnectionCosts(K){return this.connection_costs.loadConnectionCosts(K),this}loadUnknownDictionaries(K,$,q,J,Q,X){return this.unknown_dictionary.loadUnknownDictionaries(K,$,q,J,Q,X),this}}var y=q8;var C8=/^(\w+)\s+(\d)\s+(\d)\s+(\d)/,x8=/^(0x[0-9A-F]{4})(?:\s+([^#\s]+))(?:\s+([^#\s]+))*/,m8=/^(0x[0-9A-F]{4})\.\.(0x[0-9A-F]{4})(?:\s+([^#\s]+))(?:\s+([^#\s]+))*/;class J8{char_def;character_category_definition;category_mapping;constructor(){this.char_def=new I,this.char_def.invoke_definition_map=new m,this.character_category_definition=[],this.category_mapping=[]}putLine(K){let $=C8.exec(K);if($!=null){let Q=this.character_category_definition.length,X=I.parseCharCategory(Q,$);if(X==null)return;this.character_category_definition.push(X);return}let q=x8.exec(K);if(q!=null){let Q=I.parseCategoryMapping(q);this.category_mapping.push(Q)}let J=m8.exec(K);if(J!=null){let Q=I.parseRangeCategoryMapping(J);this.category_mapping.push(Q)}}build(){if(!this.char_def||!this.char_def.invoke_definition_map)throw new Error("No data to build.");return this.char_def.invoke_definition_map.init(this.character_category_definition),this.char_def.initCategoryMappings(this.category_mapping),this.char_def}}var Q8=J8;class X8{lines;connection_cost;constructor(){this.lines=0,this.connection_cost=null}putLine(K){if(this.lines===0||!this.connection_cost){let X=K.split(" "),Z=Number.parseInt(X[0]),H=Number.parseInt(X[1]);if(Z<0||H<0)throw"Parse error of matrix.def";return this.connection_cost=new w(Z,H),this.lines++,this}if(!this.connection_cost)throw"connection_cost is null";let $=K.split(" ");if($.length!==3)return this;let q=Number.parseInt($[0]),J=Number.parseInt($[1]),Q=Number.parseInt($[2]);if(q<0||J<0||!Number.isFinite(q)||!Number.isFinite(J)||this.connection_cost.forward_dimension<=q||this.connection_cost.backward_dimension<=J)throw"Parse error of matrix.def";return this.connection_cost.put(q,J,Q),this.lines++,this}build(){if(!this.connection_cost)throw"No data to build.";return this.connection_cost}}var Z8=X8;class H8{#K;#$;#q;#J;constructor(){this.#K=[],this.#$=[],this.#q=new Z8,this.#J=new Q8}addTokenInfoDictionary(K){let $=K.split(",");return this.#K.push($),this}putCostMatrixLine(K){return this.#q.putLine(K),this}putCharDefLine(K){return this.#J.putLine(K),this}putUnkDefLine(K){return this.#$.push(K.split(",")),this}build(){let K=this.buildTokenInfoDictionary();return new y(K.trie,K.token_info_dictionary,this.#q.build(),this.buildUnknownDictionary())}buildTokenInfoDictionary(){let K=new z,$=K.buildDictionary(this.#K),q=this.buildDoubleArray();for(let J in $){let Q=$[J],X=q.lookup(Q);K.addMapping(X,Number.parseInt(J))}return{trie:q,token_info_dictionary:K}}buildUnknownDictionary(){let K=new h,$=K.buildDictionary(this.#$),q=this.#J.build();if(!q||!q.invoke_definition_map)throw new Error("CharacterDefinition is not set");K.characterDefinition(q);for(let J in $){let Q=$[J],X=q.invoke_definition_map.lookup(Q);if(!X)throw new Error(`Class name not found: ${Q}`);K.addMapping(X,Number.parseInt(J))}return K}buildDoubleArray(){let K=0,$=this.#K.map((J)=>{return{k:J[0],v:K++}});return A.builder(1048576).build($)}}var c=H8;class W8{formatEntry(K,$,q,J){return{word_id:K,word_type:q,word_position:$,surface_form:J[0],pos:J[1],pos_detail_1:J[2],pos_detail_2:J[3],pos_detail_3:J[4],conjugated_type:J[5],conjugated_form:J[6],basic_form:J[7],reading:J[8],pronunciation:J[9]}}formatUnknownEntry(K,$,q,J,Q){return{word_id:K,word_type:q,word_position:$,surface_form:Q,pos:J[1],pos_detail_1:J[2],pos_detail_2:J[3],pos_detail_3:J[4],conjugated_type:J[5],conjugated_form:J[6],basic_form:J[7]}}}var P8=W8;class Y8{name;cost;start_pos;length;left_id;right_id;prev;surface_form;shortest_cost;type;constructor(K,$,q,J,Q,X,Z,H){this.name=K,this.cost=$,this.start_pos=q,this.length=J,this.left_id=X,this.right_id=Z,this.prev=null,this.surface_form=H,this.shortest_cost=Q==="BOS"?0:Number.MAX_VALUE,this.type=Q}}var N=Y8;class U8{nodes_end_at;eos_pos;constructor(){this.nodes_end_at=[],this.nodes_end_at[0]=[new N(-1,0,0,0,"BOS",0,0,"")],this.eos_pos=1}append(K){let $=K.start_pos+K.length-1;if(this.eos_pos<$)this.eos_pos=$;let q=this.nodes_end_at[$]??[];q.push(K),this.nodes_end_at[$]=q}appendEos(){let K=this.nodes_end_at.length;this.eos_pos++,this.nodes_end_at[K]=[new N(-1,0,this.eos_pos,0,"EOS",0,0,"")]}}var G8=U8;class L8{#K;#$;#q;constructor(K){this.#K=K.trie,this.#$=K.token_info_dictionary,this.#q=K.unknown_dictionary}build(K){let $=new G8,q=new C(K),J=q.length;for(let Q=0;Q<J;Q++){let X=q.slice(Q),Z=this.#K.commonPrefixSearch(X),H=Z.length;for(let Y=0;Y<H;Y++){let U=Z[Y].v,L=Z[Y].k,B=this.#$.target_map.get(U);if(!B)throw new Error("TokenInfo dictionary is broken");for(let E of B){let M=this.#$.dictionary.getShort(E),V=this.#$.dictionary.getShort(E+2),O=this.#$.dictionary.getShort(E+4);$.append(new N(E,O,Q+1,L.length,"KNOWN",M,V,L))}}let W=X.charAt(0),P=this.#q.lookup(W);if(!Z?.length||P.is_always_invoke){let Y=W,U=X.length;if(P.is_grouping&&U>1){let M=P.class_name;for(let V=1;V<U;V++){let O=X.charAt(V);if(this.#q.lookup(O).class_name!==M)break;Y+=O}}let L=this.#q.target_map.get(P.class_id);if(!L)throw new Error("Unknown dictionary is broken");let B=L.length,E=this.#q.dictionary;for(let M=0;M<B;M++){let V=L[M];$.append(new N(V,E.getShort(V+4),Q+1,Y.length,"UNKNOWN",E.getShort(V),E.getShort(V+2),Y))}}}return $.appendEos(),$}}var V8=L8;class j8{#K;constructor(K){this.#K=K}search(K){let $=K;return $=this.#$($),this.#q($)}#$(K){let $=1;for($=1;$<=K.eos_pos;$++){let q=K.nodes_end_at[$];if(q==null)continue;for(let J of q){let Q=Number.MAX_VALUE,X=null,Z=J.start_pos-1;if(!(Z in K.nodes_end_at))continue;let H=K.nodes_end_at[Z];for(let W of H){let P;if(J.left_id==null||W.right_id==null)console.log("Left or right is null"),P=0;else P=this.#K.get(W.right_id,J.left_id);let Y=W.shortest_cost+P+J.cost;if(Y<Q)X=W,Q=Y}J.prev=X,J.shortest_cost=Q}}return K}#q(K){let $=[],J=K.nodes_end_at[K.nodes_end_at.length-1][0].prev;if(J==null)return[];while(J.type!=="BOS"){if($.push(J),J.prev==null)return[];J=J.prev}return $.reverse()}}var F8=j8;class s{#K;#$;#q;#J;#Q;constructor(K){this.#K=K.token_info_dictionary,this.#$=K.unknown_dictionary,this.#q=new V8(K),this.#J=new F8(K.connection_costs),this.#Q=new P8}static splitByPunctuation(K){let $=K.matchAll(/、|。/g),q=[],J=0;for(let Q of $){let X=Q.index;q.push(K.slice(J,X+1)),J=X+1}if(J<K.length)q.push(K.slice(J));return q}tokenize(K){let $=s.splitByPunctuation(K),q=[];for(let J of $)this.#X(J,q);return q}#X(K,$=[]){let q=this.#q.build(K),J=this.#J.search(q),Q=$.length>0?$[$.length-1].word_position:0;for(let X of J)$.push(this.#Z(X,Q));return $}#Z(K,$){let q=K.type==="KNOWN"?this.#K.getFeatures(K.name):this.#$.getFeatures(K.name),J=q?q.split(","):[];if(K.type==="UNKNOWN")return this.#Q.formatUnknownEntry(K.name,$+K.start_pos,K.type,J,K.surface_form);return this.#Q.formatEntry(K.name,$+K.start_pos,K.type,J)}}var E8=s;var k=require("node:fs"),M8=a(require("node:path")),I8=a(require("node:zlib"));class z8{#K;constructor(K="dict/"){this.#K=K}#$=(K)=>new Promise(($,q)=>{if(!k.existsSync(K))return q(new Error(`${K} does not exist`));let J=k.readFileSync(K);I8.default.gunzip(new Uint8Array(J),(Q,X)=>{if(Q)return q(Q);let Z=new Uint8Array(X);$(Z.buffer)})});load(K){let $=new y;Promise.all(["base.dat.gz","check.dat.gz","tid.dat.gz","tid_pos.dat.gz","tid_map.dat.gz","cc.dat.gz","unk.dat.gz","unk_pos.dat.gz","unk_map.dat.gz","unk_char.dat.gz","unk_compat.dat.gz","unk_invoke.dat.gz"].map((q)=>this.#$(M8.default.join(this.#K,q)))).then((q)=>{$.loadTrie(new Int32Array(q[0]),new Int32Array(q[1])),$.loadTokenInfoDictionaries(new Uint8Array(q[2]),new Uint8Array(q[3]),new Uint8Array(q[4])),$.loadConnectionCosts(new Int16Array(q[5])),$.loadUnknownDictionaries(new Uint8Array(q[6]),new Uint8Array(q[7]),new Uint8Array(q[8]),new Uint8Array(q[9]),new Uint32Array(q[10]),new Uint8Array(q[11])),K(null,$)}).catch((q)=>{K(q,$)})}}var N8=z8;class R8{#K;constructor(K={}){this.#K=new N8(K.dicPath)}build(K){this.#K.load(($,q)=>{K($,new E8(q))})}}var d=R8;var h8={builder:(K={})=>{return new d(K)},dictionaryBuilder:()=>{return new c}};

//# debugId=483CFCF8B76FC0EE64756E2164756E21
//# sourceMappingURL=index.min.js.map
